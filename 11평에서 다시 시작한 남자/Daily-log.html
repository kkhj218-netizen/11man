<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Daily ì‹¤í–‰ ê¸°ë¡ â€“ ìˆ˜ìµ ë‹¤ê°í™” ë¡œê·¸</title>

  <style>
    :root {
      --bg: #f5f5f7;
      --card: #ffffff;
      --text-main: #111111;
      --text-sub: #555555;
      --border: #e2e2e7;
      --radius-lg: 24px;
      --radius-md: 16px;
      --shadow-soft: 0 18px 40px rgba(0,0,0,0.06);
      --accent: #0f766e;
      --accent-soft: #ecfdf5;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: var(--bg);
      color: var(--text-main);
    }

    .wrap {
      max-width: 960px;
      margin: 0 auto;
      padding: 28px 16px 80px;
    }

    .top-nav {
      font-size: 13px;
      margin-bottom: 10px;
    }
    .top-nav a {
      color: #555;
      text-decoration: none;
    }
    .top-nav a:hover {
      text-decoration: underline;
    }

    /* í—¤ë”ëŠ” ê¸°ì¡´ ëŠë‚Œ ìœ ì§€ */
    header {
      padding: 20px 20px 18px;
      margin-bottom: 26px;
      border-radius: var(--radius-lg);
      background: #111;
      color: #fff;
    }
    header h1 {
      margin: 0 0 6px;
      font-size: 22px;
    }
    header p {
      margin: 0;
      font-size: 13px;
      color: #e5e5e5;
      line-height: 1.6;
    }

    /* ìƒˆ ë ˆì´ì•„ì›ƒ */
    .main-grid {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1fr);
      gap: 18px;
      align-items: flex-start;
    }

    .panel {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .section {
      background: var(--card);
      border-radius: var(--radius-md);
      padding: 18px 18px 20px;
      border: 1px solid var(--border);
    }

    h2 {
      font-size: 17px;
      margin: 0 0 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    h2 span.emoji {
      font-size: 18px;
    }

    p {
      font-size: 14px;
      line-height: 1.7;
      color: var(--text-sub);
    }

    /* ìš”ì•½ ì¹´ë“œ */
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
      margin-top: 8px;
    }

    .summary-card {
      border-radius: 12px;
      padding: 10px 12px 11px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
    }

    .summary-label {
      font-size: 11px;
      color: #6b7280;
      margin-bottom: 4px;
    }

    .summary-value {
      font-size: 18px;
      font-weight: 600;
      color: #0f172a;
    }

    .summary-sub {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 2px;
    }

    /* ì›” ì„ íƒ ë°” */
    .month-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 4px;
      font-size: 13px;
      color: #6b7280;
      gap: 10px;
      flex-wrap: wrap;
    }

    .month-pills {
      display: inline-flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .month-pill {
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      font-size: 12px;
      background: #f9fafb;
      color: #4b5563;
      cursor: pointer;
    }

    .month-pill.active {
      background: #0f172a;
      color: #f9fafb;
      border-color: #0f172a;
    }

    /* íƒ€ì„ë¼ì¸ */
    .timeline {
      margin-top: 6px;
    }

    .timeline-item {
      position: relative;
      padding-left: 18px;
      margin-bottom: 16px;
    }

    .timeline-item::before {
      content: "";
      position: absolute;
      left: 6px;
      top: 4px;
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
    }

    .timeline-item::after {
      content: "";
      position: absolute;
      left: 8.5px;
      top: 14px;
      width: 1px;
      height: calc(100% - 10px);
      background: #e5e7eb;
    }

    .timeline-item:last-child::after {
      display: none;
    }

    .timeline-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 4px;
    }

    .date-label {
      font-size: 13px;
      font-weight: 600;
      color: #0f172a;
    }

    .weekday {
      font-size: 12px;
      color: #6b7280;
    }

    .tag-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin: 4px 0 6px;
    }

    .tag {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: #115e59;
    }

    .log-list {
      margin: 0;
      padding-left: 16px;
    }

    .log-list li {
      font-size: 13px;
      line-height: 1.6;
      color: #4b5563;
    }

    .log-note {
      margin-top: 4px;
      font-size: 12px;
      color: #9ca3af;
    }

    /* ì˜¤ë¥¸ìª½ íŒ¨ë„ */
    .hint-title {
      font-size: 13px;
      font-weight: 600;
      color: #111827;
      margin-bottom: 6px;
    }

    .hint-list {
      margin: 0;
      padding-left: 18px;
      font-size: 13px;
      color: #4b5563;
      line-height: 1.7;
    }

    .template-box {
      margin-top: 8px;
      padding: 10px 12px;
      border-radius: 10px;
      background: #f9fafb;
      border: 1px dashed #d1d5db;
      font-size: 13px;
      color: #4b5563;
      white-space: pre-line;
    }

    .mini-label {
      display: inline-block;
      font-size: 11px;
      padding: 2px 7px;
      border-radius: 999px;
      background: #eff6ff;
      color: #1d4ed8;
      margin-bottom: 4px;
    }

    @media (max-width: 768px) {
      .wrap {
        padding: 22px 14px 60px;
      }
      .main-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top-nav">
      <a href="index.html">â† 11í‰ í—ˆë¸Œë¡œ ëŒì•„ê°€ê¸°</a>
    </div>

    <header>
      <h1>ìˆ˜ìµ ë‹¤ê°í™” Daily ì‹¤í–‰ ê¸°ë¡</h1>
      <p>
        â€œì˜¤ëŠ˜ ìˆ˜ìµ ë‹¤ê°í™”ë¥¼ ìœ„í•´ í•œ ì¼â€ì„ ì§§ê²Œ ë‚¨ê¸°ëŠ” ê³µê°„ì…ë‹ˆë‹¤.<br />
        ê±°ì°½í•œ ì„±ê³¼ë³´ë‹¤, ì‘ê²Œë¼ë„ ì›€ì§ì¸ ê¸°ë¡ì„ ìŒ“ëŠ” ë° ì§‘ì¤‘í•©ë‹ˆë‹¤.
      </p>
    </header>

    <main class="main-grid">
      <!-- ì™¼ìª½: ìš”ì•½ + íƒ€ì„ë¼ì¸ -->
      <section class="panel">
        <div class="section">
          <h2><span class="emoji">ğŸ“Š</span>ì´ë²ˆ ë‹¬ ì‹¤í–‰ ìš”ì•½</h2>
          <p id="summary-desc">
            ì‹œíŠ¸ì— ê¸°ë¡ëœ ë°ì´í„°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ, ì´ë²ˆ ë‹¬ ì‹¤í–‰ í˜„í™©ì„ ì •ë¦¬í•´ ë³´ì—¬ì¤ë‹ˆë‹¤.
          </p>

          <div id="summary-cards" class="summary-grid">
            <!-- JSì—ì„œ ì±„ì›€ -->
          </div>

          <div class="month-row">
            <span id="current-month-label">ì§€ê¸ˆ ë³´ëŠ” ê¸°ë¡: -</span>
            <div id="month-pills" class="month-pills">
              <!-- JSì—ì„œ ì±„ì›€ -->
            </div>
          </div>
        </div>

        <div class="section">
          <h2><span class="emoji">ğŸ“…</span><span id="timeline-title">ì‹¤í–‰ íƒ€ì„ë¼ì¸</span></h2>
          <p style="font-size:13px; color:#6b7280; margin-top:0;">
            ë‚ ì§œë³„ë¡œ ì–´ë–¤ ì‹¤í–‰ì„ í–ˆëŠ”ì§€, ìœ„ì—ì„œ ì•„ë˜ë¡œ ì‹œê°„ìˆœìœ¼ë¡œ ë‚´ë ¤ê°€ë©° ì •ë¦¬í–ˆìŠµë‹ˆë‹¤.
          </p>

          <div id="timeline" class="timeline">
            <!-- JSì—ì„œ ì±„ì›€ -->
          </div>
        </div>
      </section>

      <!-- ì˜¤ë¥¸ìª½: í…œí”Œë¦¿ & íŒ -->
      <aside class="panel">
        <div class="section">
          <span class="mini-label">ê¸°ë¡ í…œí”Œë¦¿</span>
          <h2 style="margin-top:4px;"><span class="emoji">âœï¸</span>ì˜¤ëŠ˜ ì‹¤í–‰ í•œ ì¤„ ìš”ì•½</h2>
          <p>
            11í‰ ì›¹ í˜ì´ì§€ í”„ë ˆì„ ì„¤ê³„ ë° ì œì‘ 30% ì •ë„? (ì™„) 25ë…„ 12ì›” 9ì¼ 
          </p>

          <div class="template-box">
(date)     : 2025-12-9ì¼ ê¸°ì¤€  
(weekday) : ì›”  
(tags)    : ë¸Œëœë”©,í˜ì´ì§€ ê°œì„ ,êµ¬ì¡° ì„¤ê³„, ì›¹ í˜ì´ì§€ ê¸€ ìƒì„±   
(action)  : 11í‰ í—ˆë¸Œ ë©”ì¸ í˜ì´ì§€ UI ë‹¤ë“¬ê³ , "ì¢‹ì€ ê¸€ë“¤" ë²„íŠ¼ ì¶”ê°€  
(note)    : í•œ ë²ˆ ë§Œë“¤ì–´ë‘” êµ¬ì¡° ê³„ì† ë‹¤ë“¬ê¸°
          </div>
        </div>

        <div class="section">
          <h2><span class="emoji">ğŸ’¡</span>ëª©í‘œ</h2>
          <div class="hint-title">ì–´ë–»ê²Œ ê¾¸ì¤€íˆ ìœ ì§€ í•  ìˆ˜ ìˆì„ê¹Œ?</div>
          <ul class="hint-list">
            <li>ì™„ë²½í•œ ë‚´ìš©ë³´ë‹¤, <strong>ëª»í•´ë„ ë§¤ì£¼ ê¾¸ì¤€íˆ</strong> ê¸°ë¡í•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ</li>
            <li>ì˜ ë ì§€ ëª¨ë¥´ê² ì§€ë§Œ ì¼ë‹¨.. <strong>ê¾¸ì¤€íˆ</strong> ê¸€ì„ í•œê°œ, í•œê°œì”© ëŠ˜ë¦¬ëŠ” ê²ƒì„ ëª©í‘œë¡œ ë‚˜ê°€ê² ë‹¤.</li>
            <li>ëª»í•´ë„ ì£¼ì— 1ë²ˆ ì´ìƒì€ ì—…ë°ì´íŠ¸ë¥¼ ëª©í‘œë¡œ..</li>
          </ul>
        </div>
      </aside>
    </main>
  </div>

  <script>
    // â˜… ì—¬ê¸°ì— ë³¸ì¸ Apps Script ì›¹ ì•± URLì„ ë„£ì–´ì£¼ì„¸ìš”
    const API_URL = "https://script.google.com/macros/s/AKfycbwP0bzkgJOkIeL3zqBFFPE6zAsWC_wQajVVnTbmSqYtcDsrO5QGS3aH8vvlOYv8PIWyMQ/exec";

    const summaryCardsEl = document.getElementById("summary-cards");
    const monthPillsEl = document.getElementById("month-pills");
    const currentMonthLabelEl = document.getElementById("current-month-label");
    const timelineEl = document.getElementById("timeline");
    const timelineTitleEl = document.getElementById("timeline-title");

    let allRows = [];
    let allMonths = [];

    function fetchData() {
      fetch(API_URL)
        .then(res => res.json())
        .then(data => {
          allRows = data || [];
          if (allRows.length === 0) {
            timelineEl.innerHTML = "<p style='font-size:13px;color:#6b7280;'>ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤. Google Sheetsì— ì²« ë²ˆì§¸ ë¡œê·¸ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”.</p>";
            return;
          }

          // '2025-12' 09ì¼ ë¦¬ìŠ¤íŠ¸ ì¶”ì¶œ
          allMonths = Array.from(new Set(
            allRows
              .map(r => (r.date || "").slice(0, 7))
              .filter(Boolean)
          )).sort();

          const latestMonth = allMonths[allMonths.length - 1];
          renderMonthPills(latestMonth);
          applyMonthFilter(latestMonth);
        })
        .catch(err => {
          console.error(err);
          timelineEl.innerHTML = "<p style='font-size:13px;color:#b91c1c;'>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. Apps Script URL ë˜ëŠ” ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.</p>";
        });
    }

    function renderMonthPills(activeMonth) {
      monthPillsEl.innerHTML = "";
      allMonths.forEach(month => {
        const span = document.createElement("span");
        span.className = "month-pill" + (month === activeMonth ? " active" : "");
        const [y, m] = month.split("-");
        span.textContent = m;
        span.title = `${12}ë…„ ${9}ì›”`;
        span.dataset.month = month;
        span.addEventListener("click", () => {
          document.querySelectorAll(".month-pill").forEach(p => p.classList.remove("active"));
          span.classList.add("active");
          applyMonthFilter(month);
        });
        monthPillsEl.appendChild(span);
      });
    }

    function applyMonthFilter(month) {
      const filtered = allRows.filter(r => (r.date || "").startsWith(month));
      const [y, m] = month.split("-");
      currentMonthLabelEl.textContent = `ì§€ê¸ˆ ë³´ëŠ” ê¸°ë¡: ${y}ë…„ ${m}ì›”`;
      timelineTitleEl.textContent = `${y}-${m} ì‹¤í–‰ íƒ€ì„ë¼ì¸`;
      renderSummary(filtered, month);
      renderTimeline(filtered);
    }

    function renderSummary(rows, month) {
      if (!rows || rows.length === 0) {
        summaryCardsEl.innerHTML = `
          <div class="summary-card">
            <div class="summary-label">ì´ë²ˆ ë‹¬ ê¸°ë¡ì¼</div>
            <div class="summary-value">0ì¼</div>
            <div class="summary-sub">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>
          </div>
        `;
        return;
      }

      // ë‚ ì§œë³„ ë¬¶ê¸°
      const dateSet = new Set();
      rows.forEach(r => { if (r.date) dateSet.add(r.date); });
      const uniqueDates = Array.from(dateSet).sort();

      // ìµœì¥ ì—°ì†ì¼ ê³„ì‚°
      const streak = calcMaxStreak(uniqueDates);

      const totalDays = uniqueDates.length;
      const totalItems = rows.length;

      summaryCardsEl.innerHTML = `
        <div class="summary-card">
          <div class="summary-label">ì›¹ì‚¬ì´íŠ¸ 12ì›” 7ì¼ ë¶€í„° ìˆ˜ì • </div>
          <div class="summary-value">${3}ì¼</div>
          <div class="summary-sub">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ 12ì›” 9ì¼</div>
        </div>
        <div class="summary-card">
          <div class="summary-label">íŠ¸ë ˆì´ë”© ê¸°ë¡</div>
          <div class="summary-value">${1}ê°œ</div>
          <div class="summary-sub">12ì›” 9ì¼ ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸</div>
        </div>
        <div class="summary-card">
          <div class="summary-label">íˆ¬ì ê´€ë ¨ í¬ìŠ¤íŒ…</div>
          <div class="summary-value">${streak}ì¼</div>
          <div class="summary-sub">12ì›” 9ì¼ ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸</div>
        </div>
      `;
    }

    function calcMaxStreak(dateStrings) {
      if (dateStrings.length === 0) return 0;
      const dates = dateStrings.map(d => new Date(d + "T00:00:00"));
      dates.sort((a, b) => a - b);

      let maxStreak = 1;
      let currentStreak = 1;

      for (let i = 1; i < dates.length; i++) {
        const prev = dates[i - 1];
        const curr = dates[i];
        const diffDays = (curr - prev) / (1000 * 60 * 60 * 24);

        if (diffDays === 1) {
          currentStreak++;
        } else {
          currentStreak = 1;
        }
        if (currentStreak > maxStreak) maxStreak = currentStreak;
      }
      return maxStreak;
    }

    function renderTimeline(rows) {
      if (!rows || rows.length === 0) {
        timelineEl.innerHTML = "<p style='font-size:13px;color:#6b7280;'>ì´ ë‹¬ì—ëŠ” ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
        return;
      }

      // ë‚ ì§œë³„ ê·¸ë£¹í•‘
      const byDate = {};
      rows.forEach(r => {
        const date = r.date || "";
        if (!byDate[date]) {
          byDate[date] = {
            date,
            weekday: r.weekday || "",
            items: [],
            tags: new Set(),
            notes: []
          };
        }
        if (r.action) {
          byDate[date].items.push(r.action);
        }
        if (r.tags) {
          r.tags.split(",").map(t => t.trim()).filter(Boolean).forEach(t => byDate[date].tags.add(t));
        }
        if (r.note) {
          byDate[date].notes.push(r.note);
        }
      });

      const dates = Object.keys(byDate).sort().reverse(); // ìµœì‹  ë‚ ì§œê°€ ìœ„ë¡œ
      timelineEl.innerHTML = "";

      dates.forEach(date => {
        const dayData = byDate[date];
        const wrapper = document.createElement("article");
        wrapper.className = "timeline-item";

        const header = document.createElement("div");
        header.className = "timeline-header";

        const left = document.createElement("div");
        const dateLabel = document.createElement("div");
        dateLabel.className = "date-label";
        dateLabel.textContent = dayData.date || "-";

        const weekday = document.createElement("div");
        weekday.className = "weekday";
        weekday.textContent = dayData.weekday || "";

        left.appendChild(dateLabel);
        left.appendChild(weekday);
        header.appendChild(left);
        wrapper.appendChild(header);

        // íƒœê·¸
        if (dayData.tags.size > 0) {
          const tagRow = document.createElement("div");
          tagRow.className = "tag-row";
          dayData.tags.forEach(tag => {
            const span = document.createElement("span");
            span.className = "tag";
            span.textContent = tag;
            tagRow.appendChild(span);
          });
          wrapper.appendChild(tagRow);
        }

        // ì‹¤í–‰ ë¦¬ìŠ¤íŠ¸
        if (dayData.items.length > 0) {
          const ul = document.createElement("ul");
          ul.className = "log-list";
          dayData.items.forEach(text => {
            const li = document.createElement("li");
            li.textContent = text;
            ul.appendChild(li);
          });
          wrapper.appendChild(ul);
        }

        // ë©”ëª¨
        if (dayData.notes.length > 0) {
          const note = document.createElement("div");
          note.className = "log-note";
          note.textContent = "ğŸ‘‰ " + dayData.notes[0];
          wrapper.appendChild(note);
        }

        timelineEl.appendChild(wrapper);
      });
    }

    // ì‹¤í–‰
    fetchData();
  </script>
</body>
</html>
