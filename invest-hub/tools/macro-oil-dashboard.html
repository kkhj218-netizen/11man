<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>JH ë§¤í¬ë¡œ & ìœ ê°€ ëŒ€ì‹œë³´ë“œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0f172a;
      --bg-soft: #111827;
      --card: #020617;
      --card-soft: #020617;
      --accent-up: #22c55e;
      --accent-down: #f97316;
      --accent-risk: #ef4444;
      --accent-neutral: #eab308;
      --text-main: #e5e7eb;
      --text-sub: #9ca3af;
      --border: #1f2937;
      --radius-lg: 18px;
      --radius-md: 12px;
      --shadow-soft: 0 22px 45px rgba(0,0,0,0.55);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
      background: radial-gradient(circle at top, #1f2937 0, #020617 50%, #020617 100%);
      color: var(--text-main);
    }

    .wrap {
      max-width: 1100px;
      margin: 0 auto;
      padding: 20px 16px 40px;
    }

    header {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 20px;
    }

    .title-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      flex-wrap: wrap;
    }

    h1 {
      font-size: 22px;
      margin: 0;
      font-weight: 700;
      letter-spacing: 0.03em;
    }

    .badge {
      padding: 3px 9px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid #4b5563;
      color: #d1d5db;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      background: linear-gradient(135deg, rgba(96,165,250,0.15), rgba(56,189,248,0));
    }

    .subtitle {
      font-size: 13px;
      color: var(--text-sub);
    }

    .grid {
      display: grid;
      grid-template-columns: minmax(0, 2.2fr) minmax(0, 1.8fr);
      gap: 16px;
      margin-bottom: 18px;
    }

    .card {
      background: radial-gradient(circle at top left, rgba(148,163,184,0.22), #020617 55%);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(148,163,184,0.25);
      box-shadow: var(--shadow-soft);
      padding: 16px 16px 14px;
    }

    .card-soft {
      background: linear-gradient(135deg, rgba(15,23,42,0.96), rgba(15,23,42,0.98));
      border-radius: var(--radius-lg);
      border: 1px solid rgba(31,41,55,0.9);
      box-shadow: var(--shadow-soft);
      padding: 16px 16px 14px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .card-title {
      font-size: 14px;
      font-weight: 600;
    }

    .mode-pill {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }

    .mode-attack {
      background: rgba(34,197,94,0.12);
      color: #bbf7d0;
      border: 1px solid rgba(34,197,94,0.5);
    }
    .mode-attack .dot {
      background: var(--accent-up);
      box-shadow: 0 0 12px rgba(34,197,94,0.9);
    }

    .mode-neutral {
      background: rgba(234,179,8,0.12);
      color: #facc15;
      border: 1px solid rgba(234,179,8,0.5);
    }
    .mode-neutral .dot {
      background: var(--accent-neutral);
      box-shadow: 0 0 12px rgba(234,179,8,0.95);
    }

    .mode-defense {
      background: rgba(248,113,113,0.12);
      color: #fecaca;
      border: 1px solid rgba(248,113,113,0.4);
    }
    .mode-defense .dot {
      background: var(--accent-risk);
      box-shadow: 0 0 12px rgba(248,113,113,0.9);
    }

    .headline-number {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 2px;
    }

    .headline-label {
      font-size: 12px;
      color: var(--text-sub);
      margin-bottom: 8px;
    }

    .summary-text {
      font-size: 13px;
      line-height: 1.55;
      color: #e5e7eb;
    }

    .summary-text strong { font-weight: 600; }

    .chips-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 10px;
    }

    .chip {
      font-size: 11px;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.35);
      color: #cbd5f5;
      background: rgba(15,23,42,0.8);
    }

    .chip span {
      opacity: 0.8;
      margin-right: 3px;
    }

    .inputs-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    label {
      font-size: 11px;
      color: var(--text-sub);
    }

    input[type="number"] {
      background: #020617;
      border-radius: var(--radius-md);
      border: 1px solid #374151;
      padding: 7px 9px;
      color: var(--text-main);
      font-size: 13px;
      outline: none;
    }

    input[type="number"]:focus {
      border-color: #60a5fa;
      box-shadow: 0 0 0 1px rgba(37,99,235,0.5);
    }

    .helper {
      font-size: 11px;
      color: #6b7280;
    }

    .btn-row {
      margin-top: 10px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    button {
      border-radius: 999px;
      border: none;
      padding: 7px 12px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #022c22;
      box-shadow: 0 14px 30px rgba(34,197,94,0.35);
    }

    .btn-outline {
      background: transparent;
      color: #e5e7eb;
      border: 1px solid #4b5563;
    }

    .btn-primary:active,
    .btn-outline:active {
      transform: translateY(1px);
      box-shadow: none;
    }

    .indicator-grid {
      display: grid;
      grid-template-columns: repeat(5, minmax(0, 1fr));
      gap: 10px;
      margin-bottom: 16px;
    }

    .indicator-card {
      background: linear-gradient(145deg, rgba(15,23,42,0.96), rgba(15,23,42,0.99));
      border-radius: var(--radius-md);
      border: 1px solid rgba(55,65,81,0.9);
      padding: 9px 9px 8px;
    }

    .indicator-name {
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 5px;
      display: flex;
      justify-content: space-between;
      gap: 4px;
    }

    .indicator-value {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .indicator-tag {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      border-radius: 999px;
      padding: 2px 7px;
      font-size: 10px;
      font-weight: 500;
    }

    .tag-on {
      background: rgba(34,197,94,0.14);
      color: #bbf7d0;
      border: 1px solid rgba(34,197,94,0.5);
    }

    .tag-off {
      background: rgba(239,68,68,0.14);
      color: #fecaca;
      border: 1px solid rgba(239,68,68,0.6);
    }

    .tag-neutral {
      background: rgba(234,179,8,0.1);
      color: #facc15;
      border: 1px solid rgba(234,179,8,0.6);
    }

    .indicator-comment {
      font-size: 10px;
      color: #9ca3af;
      margin-top: 3px;
      line-height: 1.45;
    }

    .horizon-grid {
      display: grid;
      grid-template-columns: repeat(6, minmax(0, 1fr));
      gap: 8px;
    }

    .horizon-item {
      background: linear-gradient(135deg, rgba(15,23,42,0.96), rgba(15,23,42,0.97));
      border-radius: 12px;
      border: 1px solid rgba(55,65,81,0.9);
      padding: 7px 8px;
    }

    .horizon-label {
      font-size: 10px;
      color: #9ca3af;
      margin-bottom: 4px;
    }

    .horizon-direction {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .horizon-note {
      font-size: 10px;
      color: #9ca3af;
      line-height: 1.4;
    }

    /* === JH OIL MODULE === */
    .oil-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1.6fr);
      gap: 16px;
      margin-top: 6px;
    }

    .oil-col {
      background: radial-gradient(circle at top, rgba(15,23,42,0.9), rgba(15,23,42,0.98));
      border-radius: 14px;
      border: 1px solid rgba(55,65,81,0.9);
      padding: 12px 12px 10px;
    }

    .oil-section-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .oil-sub {
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 8px;
      line-height: 1.5;
    }

    .oil-inv-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
      margin-bottom: 8px;
    }

    .oil-metric { margin-bottom: 8px; }

    .oil-label {
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 3px;
    }

    .oil-value-main {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .oil-value-sub {
      font-size: 11px;
      color: #9ca3af;
      line-height: 1.4;
    }

    .oil-score-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .oil-score-pill .dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
    }

    .oil-bull {
      background: rgba(34,197,94,0.14);
      color: #bbf7d0;
      border: 1px solid rgba(34,197,94,0.5);
    }
    .oil-bull .dot {
      background: #22c55e;
      box-shadow: 0 0 10px rgba(34,197,94,0.9);
    }

    .oil-neutral {
      background: rgba(234,179,8,0.14);
      color: #fde68a;
      border: 1px solid rgba(234,179,8,0.6);
    }
    .oil-neutral .dot {
      background: #eab308;
      box-shadow: 0 0 10px rgba(234,179,8,0.9);
    }

    .oil-bear {
      background: rgba(239,68,68,0.14);
      color: #fecaca;
      border: 1px solid rgba(239,68,68,0.6);
    }
    .oil-bear .dot {
      background: #ef4444;
      box-shadow: 0 0 10px rgba(239,68,68,0.9);
    }

    .oil-btn-row {
      margin-top: 8px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    /* === EIA ë¯¸ë‹ˆ ì°¨íŠ¸ === */
    .eia-chart {
      margin-top: 4px;
      font-size: 11px;
    }

    .eia-row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 4px;
    }

    .eia-label {
      width: 70px;
      color: #9ca3af;
    }

    .eia-bar-wrap {
      flex: 1;
      height: 6px;
      border-radius: 999px;
      background: #020617;
      border: 1px solid #374151;
      overflow: hidden;
      position: relative;
    }

    .eia-bar {
      position: absolute;
      top: 0;
      bottom: 0;
      left: 50%;
      transform-origin: left center;
      opacity: 0.95;
    }

    .eia-bar-positive {
      background: linear-gradient(to right, #f97316, #fb923c);
    }

    .eia-bar-negative {
      background: linear-gradient(to right, #22c55e, #4ade80);
    }

    .eia-value {
      width: 56px;
      text-align: right;
      color: #e5e7eb;
    }

    /* === OPEC ì¼ì • === */
    .opec-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 8px;
      font-size: 12px;
    }

    .opec-item {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 8px;
      padding: 6px 8px;
      border-radius: 10px;
      border: 1px solid #374151;
      background: rgba(15,23,42,0.96);
    }

    .opec-main {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .opec-title {
      font-size: 12px;
      font-weight: 600;
    }

    .opec-meta {
      font-size: 11px;
      color: #9ca3af;
    }

    .opec-note {
      font-size: 11px;
      color: #d1d5db;
    }

    .opec-tag {
      font-size: 10px;
      border-radius: 999px;
      padding: 2px 7px;
      border: 1px solid #4b5563;
      white-space: nowrap;
    }

    .opec-tag-high {
      background: rgba(239,68,68,0.12);
      color: #fecaca;
      border-color: rgba(239,68,68,0.6);
    }

    .opec-tag-normal {
      background: rgba(234,179,8,0.12);
      color: #facc15;
      border-color: rgba(234,179,8,0.6);
    }

    .opec-tag-soft {
      background: rgba(59,130,246,0.12);
      color: #bfdbfe;
      border-color: rgba(59,130,246,0.6);
    }

    .opec-dday {
      font-size: 11px;
      color: #e5e7eb;
      text-align: right;
    }

    .opec-dday span {
      display: block;
      font-size: 10px;
      color: #9ca3af;
    }

    @media (max-width: 900px) {
      .grid {
        grid-template-columns: minmax(0, 1fr);
      }
      .indicator-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
      .horizon-grid {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
      .oil-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    @media (max-width: 560px) {
      .indicator-grid {
        grid-template-columns: minmax(0, 1fr);
      }
      .horizon-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title-row">
        <h1>JH ë§¤í¬ë¡œ & ìœ ê°€ ê³µê²©Â·ë°©ì–´ ëŒ€ì‹œë³´ë“œ</h1>
        <div class="badge">JH FUND Â· INTERNAL TOOL</div>
      </div>
      <div class="subtitle">
        VIX Â· ë‹¬ëŸ¬ Â· ê¸ˆë¦¬ Â· ê¸ˆë¦¬ì°¨ Â· ìœ ê°€ 5ê°€ì§€ë¡œ ì˜¤ëŠ˜ ì‹œì¥ <strong>ê³µê²© / ì¤‘ë¦½ / ë°©ì–´ ëª¨ë“œ</strong>ì™€
        EIA ì¬ê³  Â· ìŠ¤í”„ë ˆë“œ Â· Crackë¡œ <strong>ìœ ê°€ í†¤</strong>ê¹Œì§€ í•œ ë²ˆì— ë³´ëŠ” ìš©ë„.
      </div>
    </header>

    <!-- ê³¼ì—´ / ê³¼ë§¤ë„ ë°°ë„ˆ -->
    <section id="extremeBanner" class="card-soft" style="margin-bottom:14px; display:none;">
      <div class="card-header" style="margin-bottom:6px;">
        <div class="card-title" id="extremeBannerTitle">-</div>
      </div>
      <div class="summary-text" id="extremeBannerText">
        ë§¤í¬ë¡œÂ·ìœ ê°€ ì ìˆ˜ê°€ ê³¼ì—´/ê³¼ë§¤ë„ êµ¬ê°„ì— ë“¤ì–´ì˜¤ë©´ ì´ ì˜ì—­ì—ì„œ ê²½ê³ ë¥¼ ë³´ì—¬ì¤€ë‹¤.
      </div>
    </section>

    <div class="grid">
      <!-- LEFT: SUMMARY -->
      <section class="card">
        <div class="card-header">
          <div class="card-title">ì˜¤ëŠ˜ì˜ ëª¨ë“œ â€“ JH í€ë“œ ë·°</div>
          <div id="modePill" class="mode-pill mode-neutral">
            <span class="dot"></span>
            <span id="modeLabel">ì¤‘ë¦½ ëŒ€ê¸°</span>
          </div>
        </div>
        <div class="headline-number" id="scoreDisplay">0</div>
        <div class="headline-label">ê³µê²©/ë°©ì–´ ì¢…í•© ì ìˆ˜ ( -10 ~ +10 )</div>
        <div class="summary-text" id="summaryText">
          ì§€í‘œë¥¼ ì…ë ¥í•˜ë©´ JH ë§¤í¬ë¡œ ë£°ì— ë”°ë¼ ì˜¤ëŠ˜ì˜ í†¤(ê³µê²© / ì¤‘ë¦½ / ë°©ì–´)ê³¼ ê°„ë‹¨í•œ í•´ì„ì´ ì—¬ê¸°ì— ë‚˜íƒ€ë‚œë‹¤.
        </div>
        <div class="chips-row" id="chipsRow">
          <div class="chip"><span>ì´ˆë‹¨ê¸°</span>â€“ ì•„ì§ ë°ì´í„° ì—†ìŒ</div>
          <div class="chip"><span>ë‹¨ê¸°</span>â€“ ì•„ì§ ë°ì´í„° ì—†ìŒ</div>
          <div class="chip"><span>ì¤‘ë‹¨ê¸°</span>â€“ ì•„ì§ ë°ì´í„° ì—†ìŒ</div>
        </div>
      </section>

      <!-- RIGHT: INPUTS -->
      <section class="card-soft">
        <div class="card-header">
          <div class="card-title">ì…ë ¥ê°’ â€“ ì˜¤ëŠ˜ì ë§¤í¬ë¡œ & ìœ ê°€</div>
        </div>
        <div class="inputs-grid">
          <div class="form-group">
            <label for="vix">VIX (ë³€ë™ì„± ì§€ìˆ˜)</label>
            <input id="vix" type="number" step="0.1" placeholder="ì˜ˆ: 17.5" />
            <div class="helper">ë³´í†µ 10~40 ë²”ìœ„. 20â†‘ì€ ê²½ê³„, 30â†‘ì€ ê³µí¬.</div>
          </div>
          <div class="form-group">
            <label for="dxy">ë‹¬ëŸ¬ì¸ë±ìŠ¤ DXY</label>
            <input id="dxy" type="number" step="0.1" placeholder="ì˜ˆ: 103.2" />
            <div class="helper">100 ì´í•˜: ì•½ë‹¬ëŸ¬ / 105â†‘: ê°•ë‹¬ëŸ¬(ìœ„í—˜ìì‚° ì••ë°•).</div>
          </div>
          <div class="form-group">
            <label for="yield10">ë¯¸ 10ë…„ë¬¼ ê¸ˆë¦¬ (%)</label>
            <input id="yield10" type="number" step="0.01" placeholder="ì˜ˆ: 4.25" />
            <div class="helper">4% ì•„ë˜: ìš°í˜¸ / 4.5%â†‘: ì„±ì¥ì£¼ ì••ë°•.</div>
          </div>
          <div class="form-group">
            <label for="spread">3Mâ€“10Y ê¸ˆë¦¬ì°¨ (bp)</label>
            <input id="spread" type="number" step="1" placeholder="ì˜ˆ: -80" />
            <div class="helper">ì—­ì „í­ í´ìˆ˜ë¡ ì¹¨ì²´ ìœ„í—˜(ì˜ˆ: -100bp).</div>
          </div>
          <div class="form-group">
            <label for="wti">WTI ìœ ê°€ ($)</label>
            <input id="wti" type="number" step="0.1" placeholder="ì˜ˆ: 72.4" />
            <div class="helper">70~85: ì•ˆì • / 95â†‘: ì¸í”Œë ˆ ì¬ìê·¹.</div>
          </div>
          <div class="form-group">
            <label for="brent">Brent ìœ ê°€ ($)</label>
            <input id="brent" type="number" step="0.1" placeholder="ì˜ˆ: 76.8" />
            <div class="helper">WTI/Brent ìŠ¤í”„ë ˆë“œ ê³„ì‚°ìš©.</div>
          </div>
          <div class="form-group">
            <label for="rbob">íœ˜ë°œìœ  RBOB ($/gal)</label>
            <input id="rbob" type="number" step="0.01" placeholder="ì˜ˆ: 2.35" />
            <div class="helper">3-2-1 Crack Spread ê³„ì‚°ìš©.</div>
          </div>
          <div class="form-group">
            <label for="heat">ë””ì ¤/íˆíŒ…ì˜¤ì¼ HO ($/gal)</label>
            <input id="heat" type="number" step="0.01" placeholder="ì˜ˆ: 2.80" />
            <div class="helper">3-2-1 Crack Spread ê³„ì‚°ìš©.</div>
          </div>
        </div>

        <div class="btn-row">
          <button class="btn-primary" id="calcBtn">ğŸ” ê³µê²©Â·ë°©ì–´ ì¬ê³„ì‚°</button>
          <button class="btn-outline" id="demoBtn">ğŸ’¡ ì˜ˆì‹œ ê°’ ë„£ê¸°</button>
          <button class="btn-outline" id="loadBtn">ğŸ”— ì‹œíŠ¸ì—ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</button>
        </div>
      </section>
    </div>

    <!-- INDICATOR CARDS -->
    <section class="card-soft" style="margin-bottom: 14px;">
      <div class="card-header" style="margin-bottom: 8px;">
        <div class="card-title">ì§€í‘œë³„ ê³µê²©/ë°©ì–´ ì‹œê·¸ë„ ìš”ì•½</div>
      </div>
      <div class="indicator-grid">
        <div class="indicator-card" id="ind-vix">
          <div class="indicator-name">
            <span>VIX</span>
            <span id="ind-vix-level">-</span>
          </div>
          <div class="indicator-value" id="ind-vix-value">-</div>
          <div class="indicator-tag tag-neutral" id="ind-vix-tag">ëŒ€ê¸°</div>
          <div class="indicator-comment" id="ind-vix-comment">ì…ë ¥ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ VIXê°€ ê³µê²©/ë°©ì–´ ì¤‘ ì–´ëŠ ìª½ì— ê°€ê¹Œìš´ì§€ í•´ì„.</div>
        </div>
        <div class="indicator-card" id="ind-dxy">
          <div class="indicator-name">
            <span>DXY</span>
            <span id="ind-dxy-level">-</span>
          </div>
          <div class="indicator-value" id="ind-dxy-value">-</div>
          <div class="indicator-tag tag-neutral" id="ind-dxy-tag">ëŒ€ê¸°</div>
          <div class="indicator-comment" id="ind-dxy-comment">ê°•ë‹¬ëŸ¬ vs ì•½ë‹¬ëŸ¬ì— ë”°ë¼ ì™¸êµ­ì¸ ìê¸ˆ íë¦„ íŒë‹¨.</div>
        </div>
        <div class="indicator-card" id="ind-yield">
          <div class="indicator-name">
            <span>10Y ê¸ˆë¦¬</span>
            <span id="ind-yield-level">-</span>
          </div>
          <div class="indicator-value" id="ind-yield-value">-</div>
          <div class="indicator-tag tag-neutral" id="ind-yield-tag">ëŒ€ê¸°</div>
          <div class="indicator-comment" id="ind-yield-comment">ì„±ì¥ì£¼/ê¸°ìˆ ì£¼ì— ì§ì ‘ì ì¸ ì••ë ¥ ì—¬ë¶€ ì²´í¬.</div>
        </div>
        <div class="indicator-card" id="ind-spread">
          <div class="indicator-name">
            <span>3Mâ€“10Y</span>
            <span id="ind-spread-level">-</span>
          </div>
          <div class="indicator-value" id="ind-spread-value">-</div>
          <div class="indicator-tag tag-neutral" id="ind-spread-tag">ëŒ€ê¸°</div>
          <div class="indicator-comment" id="ind-spread-comment">ì¹¨ì²´ ìœ„í—˜(ì¤‘ê¸°) íŒë‹¨ìš©. ë‹¨ê¸°ë³´ë‹¨ 1~6ê°œì›” ë·°.</div>
        </div>
        <div class="indicator-card" id="ind-wti">
          <div class="indicator-name">
            <span>WTI</span>
            <span id="ind-wti-level">-</span>
          </div>
          <div class="indicator-value" id="ind-wti-value">-</div>
          <div class="indicator-tag tag-neutral" id="ind-wti-tag">ëŒ€ê¸°</div>
          <div class="indicator-comment" id="ind-wti-comment">ì¸í”Œë ˆÂ·ê¸°ì—… ë§ˆì§„Â·ê²½ê¸° ì‹ í˜¸ë¥¼ ë™ì‹œì— ë°˜ì˜.</div>
        </div>
      </div>
    </section>

    <!-- HORIZON VIEW -->
    <section class="card-soft">
      <div class="card-header" style="margin-bottom: 8px;">
        <div class="card-title">ê¸°ê°„ë³„ ë°©í–¥ì„± ê°ê° (JH ë·° ìë™ ìš”ì•½)</div>
      </div>
      <div class="horizon-grid" id="horizonGrid">
        <div class="horizon-item">
          <div class="horizon-label">ì´ˆë‹¨ê¸° (1~3ì¼)</div>
          <div class="horizon-direction" id="hz-very-short">-</div>
          <div class="horizon-note" id="hz-very-short-note">ì§€í‘œë¥¼ ì…ë ¥í•˜ë©´ ì´ˆë‹¨ê¸° ë°©í–¥ íŒíŠ¸ë¥¼ ìë™ìœ¼ë¡œ ìš”ì•½.</div>
        </div>
        <div class="horizon-item">
          <div class="horizon-label">ë‹¨ê¸° (1ì£¼)</div>
          <div class="horizon-direction" id="hz-short">-</div>
          <div class="horizon-note" id="hz-short-note">ê³µê²©/ë°©ì–´ ëª¨ë“œì— ë”°ë¼ 1ì£¼ í†¤ ê°ê°.</div>
        </div>
        <div class="horizon-item">
          <div class="horizon-label">ì¤‘ë‹¨ê¸° (2~4ì£¼)</div>
          <div class="horizon-direction" id="hz-mid-short">-</div>
          <div class="horizon-note" id="hz-mid-short-note">ê¸ˆë¦¬Â·ìœ ê°€Â·ìŠ¤í”„ë ˆë“œ ì¡°í•© ë°˜ì˜.</div>
        </div>
        <div class="horizon-item">
          <div class="horizon-label">ì¤‘ê¸° (1~3ê°œì›”)</div>
          <div class="horizon-direction" id="hz-mid">-</div>
          <div class="horizon-note" id="hz-mid-note">ì¹¨ì²´/ì—°ì°©ë¥™ ê°€ëŠ¥ì„±ì— ë”°ë¥¸ ëª¨ë“œ.</div>
        </div>
        <div class="horizon-item">
          <div class="horizon-label">ì¥ë‹¨ê¸° (3~6ê°œì›”)</div>
          <div class="horizon-direction" id="hz-mid-long">-</div>
          <div class="horizon-note" id="hz-mid-long-note">í˜„ì¬ ì‚¬ì´í´ì˜ í›„ë°˜ë¶€ ê°ê°.</div>
        </div>
        <div class="horizon-item">
          <div class="horizon-label">ì¥ê¸° (6~12ê°œì›”)</div>
          <div class="horizon-direction" id="hz-long">-</div>
          <div class="horizon-note" id="hz-long-note">êµ¬ì¡°ì  ìš”ì¸(ê³µê¸‰/ìˆ˜ìš”)ì„ ê°„ë‹¨íˆ ë°˜ì˜.</div>
        </div>
      </div>
    </section>

    <!-- OIL TRADING MODULE -->
    <section class="card-soft" style="margin-top: 14px;">
      <div class="card-header" style="margin-bottom: 6px;">
        <div class="card-title">JH ìœ ê°€ íŠ¸ë ˆì´ë”© ëª¨ë“ˆ â€“ ì¬ê³  Â· ìŠ¤í”„ë ˆë“œ Â· Crack Â· ê³µê²©/ë°©ì–´</div>
      </div>
      <div class="oil-grid">
        <!-- LEFT: EIA ì¬ê³  ì…ë ¥ -->
        <div class="oil-col">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:6px;">
            <div class="oil-section-title">EIA ì¬ê³  ë³€í™” (ì£¼ê°„, mbbl)</div>
            <label style="font-size:11px; color:#9ca3af; display:inline-flex; align-items:center; gap:4px;">
              <input type="checkbox" id="eiaModeToggle" style="margin:0;" />
              EIA ì´ë²¤íŠ¸ ëª¨ë“œ
            </label>
          </div>
          <div class="oil-sub">
            ì£¼ê°„ EIA ë°œí‘œ í›„ <strong>í¬ë£¨ë“œ / íœ˜ë°œìœ  / ë””ì ¤</strong> ì¬ê³  ë³€í™”ë¥¼ ë„£ìœ¼ë©´
            ìë™ìœ¼ë¡œ <strong>ìˆœì¬ê³  ë°©í–¥ + ìœ ê°€ í†¤</strong>ì„ ìš”ì•½í•´ì¤€ë‹¤.
          </div>
          <div class="oil-inv-grid">
            <div class="form-group">
              <label for="eiaCrude">Crude (ì›ìœ )</label>
              <input id="eiaCrude" type="number" step="0.1" placeholder="ì˜ˆ: 3.5" />
              <div class="helper">+ë©´ ì¬ê³  ì¦ê°€(ë¹Œë“œ), -ë©´ ì¬ê³  ê°ì†Œ(ë“œë¡œìš°).</div>
            </div>
            <div class="form-group">
              <label for="eiaGas">Gasoline (íœ˜ë°œìœ )</label>
              <input id="eiaGas" type="number" step="0.1" placeholder="ì˜ˆ: -1.2" />
              <div class="helper">ì—¬ë¦„ì²  ìš´ì „ì ìˆ˜ìš”ì— ë¯¼ê°.</div>
            </div>
            <div class="form-group">
              <label for="eiaDist">Distillate (ë””ì ¤)</label>
              <input id="eiaDist" type="number" step="0.1" placeholder="ì˜ˆ: 0.8" />
              <div class="helper">ê²½ê¸°Â·ë¬¼ë¥˜ ì‚¬ì´í´ì— ë¯¼ê°.</div>
            </div>
          </div>

          <div class="oil-metric">
            <div class="oil-label">ìˆœì¬ê³ (Net) ìš”ì•½</div>
            <div class="oil-value-main" id="invNetText">-</div>
            <div class="oil-value-sub" id="invComment">
              ì¬ê³ ë¥¼ ì…ë ¥í•˜ë©´ ìˆœì¬ê³  ë°©í–¥(ë¹Œë“œ/ë“œë¡œìš°)ì´ ì—¬ê¸° í‘œì‹œëœë‹¤.
            </div>
          </div>

          <!-- EIA ìë™ ì‹œê°í™” -->
          <div class="oil-metric">
            <div class="oil-label">EIA ì¬ê³  ë¯¸ë‹ˆ ì°¨íŠ¸</div>
            <div class="eia-chart" id="eiaChart">
              <div class="eia-row">
                <div class="eia-label">Crude</div>
                <div class="eia-bar-wrap">
                  <div class="eia-bar" id="eiaBarCrude"></div>
                </div>
                <div class="eia-value" id="eiaValCrude">-</div>
              </div>
              <div class="eia-row">
                <div class="eia-label">Gasoline</div>
                <div class="eia-bar-wrap">
                  <div class="eia-bar" id="eiaBarGas"></div>
                </div>
                <div class="eia-value" id="eiaValGas">-</div>
              </div>
              <div class="eia-row">
                <div class="eia-label">Distillate</div>
                <div class="eia-bar-wrap">
                  <div class="eia-bar" id="eiaBarDist"></div>
                </div>
                <div class="eia-value" id="eiaValDist">-</div>
              </div>
              <div class="eia-row">
                <div class="eia-label">Net</div>
                <div class="eia-bar-wrap">
                  <div class="eia-bar" id="eiaBarNet"></div>
                </div>
                <div class="eia-value" id="eiaValNet">-</div>
              </div>
            </div>
          </div>

          <div class="oil-metric">
            <div class="oil-label">EIA ë°œí‘œ ì „ ë·°</div>
            <div class="oil-value-sub" id="eiaPreText">
              EIA ëª¨ë“œë¥¼ ì¼œë©´ í˜„ì¬ ë§¤í¬ë¡œ/ìœ ê°€ ì ìˆ˜ ê¸°ì¤€ìœ¼ë¡œ ë°œí‘œ ì „ ê¸°ë³¸ ìŠ¤íƒ ìŠ¤ë¥¼ ìš”ì•½í•´ì¤€ë‹¤.
            </div>
          </div>
          <div class="oil-metric">
            <div class="oil-label">EIA ë°œí‘œ í›„ ë·°</div>
            <div class="oil-value-sub" id="eiaPostText">
              ì¬ê³  ì…ë ¥ í›„, ìˆœì¬ê³  ë°©í–¥ê³¼ ìœ ê°€ ì ìˆ˜ë¥¼ ë°˜ì˜í•œ ë°œí‘œ í›„ í†¤ì„ ìš”ì•½í•´ì¤€ë‹¤.
            </div>
          </div>

          <div class="oil-btn-row">
            <button class="btn-outline" id="oilCalcBtn">ğŸ›¢ ìœ ê°€ ì‹œê·¸ë„ ë‹¤ì‹œ ê³„ì‚°</button>
          </div>
        </div>

        <!-- RIGHT: ìŠ¤í”„ë ˆë“œ + Crack + ìœ ê°€ ì ìˆ˜ -->
        <div class="oil-col">
          <div class="oil-section-title">WTI/Brent Â· Crack Spread Â· ìœ ê°€ ê³µê²©/ë°©ì–´ ì ìˆ˜</div>
          <div class="oil-metric">
            <div class="oil-label">WTI / Brent ìŠ¤í”„ë ˆë“œ</div>
            <div class="oil-value-main" id="spreadValueText">-</div>
            <div class="oil-value-sub" id="spreadComment">
              WTIì™€ Brent ê°€ê²©ì„ ì…ë ¥í•˜ë©´ ì§€ì—­ë³„ ìˆ˜ê¸‰ êµ¬ì¡°ë¥¼ ë°˜ì˜í•œ ìŠ¤í”„ë ˆë“œ ë°©í–¥ì„ ë³´ì—¬ì¤€ë‹¤.
            </div>
          </div>

          <div class="oil-metric">
            <div class="oil-label">3-2-1 Crack Spread (ëŒ€ëµ, $/bbl)</div>
            <div class="oil-value-main" id="crackValueText">-</div>
            <div class="oil-value-sub" id="crackComment">
              WTI, RBOB, HOë¥¼ ì…ë ¥í•˜ë©´ ì •ìœ  ë§ˆì§„(3-2-1 Crack)ì„ ì¶”ì •í•´ì¤€ë‹¤.
            </div>
          </div>

          <div class="oil-metric">
            <div class="oil-label">ìœ ê°€ ì „ìš© ê³µê²©/ë°©ì–´ ì ìˆ˜ (-5 ~ +5)</div>
            <div id="oilScorePill" class="oil-score-pill oil-neutral">
              <span class="dot"></span>
              <span id="oilScoreLabel">ì¤‘ë¦½ Â· ë°©í–¥ ëŒ€ê¸°</span>
            </div>
            <div class="oil-value-main" id="oilScoreNumber">0.0</div>
            <div class="oil-value-sub" id="oilScoreComment">
              ì¬ê³ (Net) Â· WTI/Brent Â· Crack Spreadë¥¼ ì¡°í•©í•´
              <strong>ìœ ê°€ ë² ì–´/ë¶ˆ êµ¬ê°„</strong>ì„ ê°ê°ì ìœ¼ë¡œ ë³´ì—¬ì¤€ë‹¤.
            </div>
          </div>

          <div class="oil-metric">
            <div class="oil-label">ì˜¤ëŠ˜ ìœ ê°€ ë§¤ë§¤ ì•¡ì…˜ ìš”ì•½</div>
            <div class="oil-value-main" id="oilActionTitle">-</div>
            <div class="oil-value-sub" id="oilActionText">
              ìœ ê°€ ì ìˆ˜ì— ë”°ë¼ ì˜¤ëŠ˜ì€ ë¡±/ìˆ/ê´€ë§ ì¤‘ ì–´ë–¤ ìŠ¤íƒ ìŠ¤ë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ë‘˜ì§€ ìš”ì•½í•´ì¤€ë‹¤.
            </div>
          </div>

          <div class="oil-metric">
            <div class="oil-label">ìŠ¤í”„ë ˆë“œ/Crack ê¸°ë°˜ ì „ëµ íŒíŠ¸</div>
            <div class="oil-value-sub" id="oilStrategyText">
              WTI/Brent ìŠ¤í”„ë ˆë“œì™€ Crack ìˆ˜ì¤€ì„ ë°”íƒ•ìœ¼ë¡œ, ì •ìœ Â·ì—ë„ˆì§€ ì„¹í„°ì— ëŒ€í•œ ê¸°ë³¸ ì „ëµ ì•„ì´ë””ì–´ë¥¼ ê°„ë‹¨íˆ ë³´ì—¬ì¤€ë‹¤.
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- í¬ì§€ì…˜ ì‚¬ì´ì¦ˆ & ì†ìµë¹„ ê³„ì‚°ê¸° -->
    <section class="card-soft" style="margin-top:14px;">
      <div class="card-header" style="margin-bottom:8px;">
        <div class="card-title">í¬ì§€ì…˜ ì‚¬ì´ì¦ˆ & ì†ìµë¹„ ê³„ì‚°ê¸°</div>
      </div>
      <div class="inputs-grid">
        <div class="form-group">
          <label for="psEquity">ê³„ì¢Œ ì´ìë³¸ ($)</label>
          <input id="psEquity" type="number" step="100" placeholder="ì˜ˆ: 20000" />
        </div>
        <div class="form-group">
          <label for="psRiskPct">íŠ¸ë ˆì´ë“œë‹¹ ë¦¬ìŠ¤í¬ (%)</label>
          <input id="psRiskPct" type="number" step="0.1" placeholder="ì˜ˆ: 1.0" />
          <div class="helper">ë³´í†µ 0.5~2% ì‚¬ì´ ê¶Œì¥.</div>
        </div>
        <div class="form-group">
          <label for="psEntry">ì§„ì…ê°€ (Entry, $)</label>
          <input id="psEntry" type="number" step="0.01" placeholder="ì˜ˆ: 75.20" />
        </div>
        <div class="form-group">
          <label for="psStop">ì†ì ˆê°€ (Stop, $)</label>
          <input id="psStop" type="number" step="0.01" placeholder="ì˜ˆ: 73.70" />
        </div>
        <div class="form-group">
          <label for="psTarget">ëª©í‘œê°€ (Target, $)</label>
          <input id="psTarget" type="number" step="0.01" placeholder="ì˜ˆ: 78.50" />
        </div>
        <div class="form-group">
          <label for="psInstrument">ìƒí’ˆ íƒ€ì…</label>
          <select id="psInstrument" style="background:#020617; border-radius:12px; border:1px solid #374151; padding:7px 9px; color:#e5e7eb; font-size:13px;">
            <option value="CL">WTI ì„ ë¬¼ (CL)</option>
            <option value="MCL">Micro WTI (MCL)</option>
            <option value="ETF">ETF/ETN (1$ë‹¹ 1ë‹¨ìœ„)</option>
          </select>
          <div class="helper">CL: 1ë‹¬ëŸ¬ë‹¹ ì•½ $1,000 / MCL: ì•½ $100 ê¸°ì¤€.</div>
        </div>
      </div>
      <div class="btn-row">
        <button class="btn-primary" id="psCalcBtn">ğŸ“ í¬ì§€ì…˜ ê³„ì‚°</button>
      </div>
      <div class="summary-text" id="psResultMain" style="margin-top:8px;">
        ê³„ì¢ŒÂ·ì§„ì…/ì†ì ˆÂ·ëª©í‘œë¥¼ ë„£ìœ¼ë©´ ì ì • ê³„ì•½ ìˆ˜ì™€ ì†ìµë¹„ê°€ ê³„ì‚°ëœë‹¤.
      </div>
      <div class="helper" id="psResultDetail"></div>
    </section>

    <!-- OPEC ì¼ì • & ì´ë²¤íŠ¸ ëª¨ë‹ˆí„° -->
    <section class="card-soft" style="margin-top:14px;">
      <div class="card-header" style="margin-bottom:8px;">
        <div class="card-title">OPEC ì¼ì • & ì´ë²¤íŠ¸ ëª¨ë‹ˆí„°</div>
      </div>
      <div class="summary-text">
        OPEC/OPEC+ íšŒì˜Â·ì›”ê°„ ë³´ê³ ì„œÂ·ê¸´ê¸‰ íšŒì˜ ë“± <strong>ìœ ê°€ê°€ íŠ€ëŠ” ì´ë²¤íŠ¸</strong>ë¥¼
        ê°„ë‹¨í•œ ë¦¬ìŠ¤íŠ¸ë¡œ ì •ë¦¬í•´ì„œ â€œD-ë°ì´â€ ê¸°ì¤€ìœ¼ë¡œ ê°ê°ì„ ì¡ëŠ” ìš©ë„.
      </div>
      <div class="opec-list" id="opecList"></div>
      <div class="helper" style="margin-top:6px;">
        â€» ì‹¤ì œ ì¼ì •ìœ¼ë¡œ ì“°ê³  ì‹¶ìœ¼ë©´, ì•„ë˜ ìŠ¤í¬ë¦½íŠ¸ì˜ <code>OPEC_EVENTS</code> ë°°ì—´ë§Œ ê³ ì³ì£¼ë©´ ëœë‹¤. (ë‚ ì§œÂ·ì œëª©Â·ë©”ëª¨ ìˆ˜ì •)
      </div>
    </section>

    <!-- ì˜¤ëŠ˜ ë·° ë©”ëª¨ & ì‹œíŠ¸ ì €ì¥ -->
    <section class="card-soft" style="margin-top:14px;">
      <div class="card-header" style="margin-bottom:8px;">
        <div class="card-title">ì˜¤ëŠ˜ ë§¤í¬ë¡œÂ·ìœ ê°€ ë·° ë©”ëª¨ & ì‹œíŠ¸ ì €ì¥</div>
      </div>
      <div class="form-group" style="margin-bottom:8px;">
        <label for="todayMemo">ì˜¤ëŠ˜ ëŠë‚€ ì‹œì¥ í†¤ Â· ë©”ëª¨</label>
        <textarea id="todayMemo" rows="3" style="background:#020617; border-radius:12px; border:1px solid #374151; padding:7px 9px; color:#e5e7eb; font-size:13px; resize:vertical;" placeholder="ì˜ˆ: VIXëŠ” ë‚®ì€ë° DXYê°€ ê°•í•´ì„œ í…Œí¬ëŠ” ìƒê°ë³´ë‹¤ í˜ì´ ì•ˆ ë¶™ìŒ. CLì€ EIA ì „ê¹Œì§€ ë°©í–¥ ë² íŒ… ìì œ."></textarea>
      </div>
      <div class="btn-row">
        <button class="btn-outline" id="saveMemoBtn">ğŸ“ ì˜¤ëŠ˜ ë·° + ì…ë ¥ê°’ ì‹œíŠ¸ë¡œ ë³´ë‚´ê¸°</button>
      </div>
      <div class="helper" id="memoStatus">ì‹œíŠ¸ ì €ì¥ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œëœë‹¤.</div>
    </section>
  </div>

  <script>
    // ========================
    // ì „ì—­ ìƒíƒœ
    // ========================
    let lastMacroScore = 0;
    let lastOilScore = 0;

    // OPEC ì¼ì • (ì˜ˆì‹œ) â€” ì—¬ê¸°ë§Œ ìˆ˜ì •í•´ì„œ ì‹¤ì œ ì¼ì •ìœ¼ë¡œ ì‚¬ìš©
    const OPEC_EVENTS = [
      {
        date: "2025-12-17",
        title: "OPEC+ ì •ê¸° íšŒì˜ (ì˜ˆì‹œ)",
        importance: "high",
        note: "ê°ì‚°/ì¦ì‚° ê²°ì • ê°€ëŠ¥ì„± ì²´í¬."
      },
      {
        date: "2026-01-15",
        title: "OPEC ì›”ê°„ ë³´ê³ ì„œ ë°œê°„ (ì˜ˆì‹œ)",
        importance: "normal",
        note: "ìˆ˜ìš” ì „ë§Â·ìƒì‚° ê°€ì´ë˜ìŠ¤ ì—…ë°ì´íŠ¸."
      },
      {
        date: "2026-03-01",
        title: "OPEC+ ê³µë™ ê¸°ìˆ ìœ„ì›íšŒ(JTC) (ì˜ˆì‹œ)",
        importance: "soft",
        note: "ì‹œì¥ ë°¸ëŸ°ìŠ¤ ë…¼ì˜, í–¥í›„ íšŒì˜ í†¤ íŒíŠ¸."
      }
    ];

    // ========================
    // 1) ìˆ«ì íŒŒì‹± í•¨ìˆ˜
    // ========================
    function parse(v) {
      if (v === null || v === undefined) return null;
      const s = String(v).trim();
      if (s === "") return null;
      const n = Number(s.replace(/,/g, ""));
      return Number.isFinite(n) ? n : null;
    }

    // ========================
    // 2) ë§¤í¬ë¡œ ì§€í‘œ í‰ê°€ ë¡œì§
    // ========================
    function evalVix(vix) {
      if (vix == null) return {score: 0, tag: "neutral", level: "-", valueText: "-", comment: "VIX ì…ë ¥ ì—†ìŒ."};
      let score = 0, tag = "neutral", level, comment;

      if (vix < 15) {
        score = 2; tag = "on"; level = "ì €ë³€ë™ Â· ìš°í˜¸ì ";
        comment = "ê³µí¬ê°€ ê±°ì˜ ì—†ëŠ” êµ¬ê°„. ê³µê²© í¬ì§€ì…˜ì— ìœ ë¦¬í•œ í™˜ê²½.";
      } else if (vix < 20) {
        score = 1; tag = "neutral"; level = "ì •ìƒ ë²”ìœ„";
        comment = "ì •ìƒì ì¸ ë³€ë™ì„±. ì¢…ëª©/ì„¹í„° ìœ„ì£¼ë¡œ ì„ íƒì  ê³µê²© ê°€ëŠ¥.";
      } else if (vix < 30) {
        score = -2; tag = "off"; level = "ê²½ê³„ êµ¬ê°„";
        comment = "ë³€ë™ì„±ì´ ì»¤ì§„ ìƒíƒœ. í¬ì§€ì…˜ ì¶•ì†ŒÂ·í˜„ê¸ˆ ë¹„ì¤‘ í™•ëŒ€ ê³ ë ¤.";
      } else {
        score = -3; tag = "off"; level = "ê³µí¬ êµ¬ê°„";
        comment = "ê¸‰ë½Â·ê¸‰ë“± ë°˜ë³µ ê³µí¬ì¥. ë°©ì–´Â·í—·ì§€ ìš°ì„ .";
      }
      return {score, tag, level, valueText: vix.toFixed(1), comment};
    }

    function evalDxy(dxy) {
      if (dxy == null) return {score: 0, tag: "neutral", level: "-", valueText: "-", comment: "DXY ì…ë ¥ ì—†ìŒ."};
      let score = 0, tag = "neutral", level, comment;

      if (dxy < 100) {
        score = 2; tag = "on"; level = "ì•½ë‹¬ëŸ¬ Â· Risk-ON";
        comment = "ë‹¬ëŸ¬ ì•½ì„¸ë¡œ ìœ„í—˜ìì‚° ì„ í˜¸ í™˜ê²½. ì‹ í¥êµ­Â·ì„±ì¥ì£¼ì— ìš°í˜¸ì .";
      } else if (dxy < 103) {
        score = 1; tag = "neutral"; level = "ì¤‘ë¦½ êµ¬ê°„";
        comment = "ë‹¬ëŸ¬ê°€ ì‹œì¥ì„ í¬ê²Œ ì••ë°•í•˜ì§€ ì•ŠëŠ” êµ¬ê°„.";
      } else if (dxy < 105) {
        score = -1; tag = "neutral"; level = "ì‚´ì§ ê°•ë‹¬ëŸ¬";
        comment = "ë‹¬ëŸ¬ ê°•ì„¸ ê¸°ìš´. ì™¸êµ­ì¸ ë§¤ë„ íë¦„ ì ê²€ í•„ìš”.";
      } else {
        score = -2; tag = "off"; level = "ê°•ë‹¬ëŸ¬ Â· Risk-OFF";
        comment = "ê°•ë‹¬ëŸ¬ êµ¬ê°„. ì‹ í¥êµ­Â·ì„±ì¥ì£¼ì—ëŠ” ì—­í’.";
      }
      return {score, tag, level, valueText: dxy.toFixed(1), comment};
    }

    function evalYield10(y) {
      if (y == null) return {score: 0, tag: "neutral", level: "-", valueText: "-", comment: "10ë…„ë¬¼ ê¸ˆë¦¬ ì…ë ¥ ì—†ìŒ."};
      let score = 0, tag = "neutral", level, comment;

      if (y < 3.8) {
        score = 2; tag = "on"; level = "ì €ê¸ˆë¦¬ Â· ì„±ì¥ì£¼ ìš°í˜¸";
        comment = "í• ì¸ìœ¨ì´ ë‚®ì•„ ì„±ì¥ì£¼Â·ê¸°ìˆ ì£¼ì— ìš°í˜¸.";
      } else if (y < 4.2) {
        score = 1; tag = "neutral"; level = "ë¬´ë‚œí•œ ìˆ˜ì¤€";
        comment = "ì‹œì¥ ì „ì²´ì— í° ë¶€ë‹´ì€ ì•„ë‹Œ ìˆ˜ì¤€.";
      } else if (y < 4.6) {
        score = -1; tag = "neutral"; level = "ë¶€ë‹´ë˜ëŠ” ê¸ˆë¦¬";
        comment = "ì„±ì¥ì£¼ ë°¸ë¥˜ì—ì´ì…˜ì— ë¶€ë‹´.";
      } else {
        score = -2; tag = "off"; level = "ê³ ê¸ˆë¦¬ Â· ì••ë°• ê°•í•¨";
        comment = "ê³ ê¸ˆë¦¬ êµ¬ê°„. ì„±ì¥ì£¼Â·ê³ PER ì¢…ëª©ì— ì—­í’.";
      }
      return {score, tag, level, valueText: y.toFixed(2) + "%", comment};
    }

    function evalSpread(spread) {
      if (spread == null) return {score: 0, tag: "neutral", level: "-", valueText: "-", comment: "ê¸ˆë¦¬ì°¨ ì…ë ¥ ì—†ìŒ."};
      let score = 0, tag = "neutral", level, comment;

      if (spread > 0) {
        score = 2; tag = "on"; level = "ì •ìƒ ê¸°ìš¸ê¸°";
        comment = "ì¥ê¸°ê¸ˆë¦¬ê°€ ë” ë†’ì€ ì •ìƒ êµ¬ì¡°. ì¹¨ì²´ ìœ„í—˜ ì œí•œì .";
      } else if (spread > -50) {
        score = 0; tag = "neutral"; level = "ê°€ë²¼ìš´ ì—­ì „";
        comment = "ì¹¨ì²´ ì‹œê·¸ë„ ìˆì§€ë§Œ ì•„ì§ì€ ì™„ì „ ê²½ê³  ë‹¨ê³„ëŠ” ì•„ë‹˜.";
      } else if (spread > -100) {
        score = -1; tag = "neutral"; level = "ì—­ì „ ì‹¬í™”";
        comment = "ì¹¨ì²´ ê°€ëŠ¥ì„±ì´ ë†’ì•„ì§€ëŠ” êµ¬ê°„.";
      } else {
        score = -2; tag = "off"; level = "ì‹¬ê°í•œ ì—­ì „";
        comment = "ì—­ì‚¬ì ìœ¼ë¡œ ì¹¨ì²´ì™€ ì—°ê²°ë˜ëŠ” ê¹Šì€ ì—­ì „.";
      }
      return {score, tag, level, valueText: spread.toFixed(0) + " bp", comment};
    }

    function evalWti(wti) {
      if (wti == null) return {score: 0, tag: "neutral", level: "-", valueText: "-", comment: "WTI ì…ë ¥ ì—†ìŒ."};
      let score = 0, tag = "neutral", level, comment;

      if (wti >= 70 && wti <= 85) {
        score = 1; tag = "on"; level = "ì•ˆì • êµ¬ê°„";
        comment = "ì¸í”Œë ˆÂ·ê¸°ì—… ë§ˆì§„ ê´€ì ì—ì„œ ë¬´ë‚œí•œ ìœ ê°€ ë ˆë²¨.";
      } else if (wti < 60) {
        score = -1; tag = "neutral"; level = "ê³¼ë„í•œ ì €ìœ ê°€";
        comment = "ìˆ˜ìš” ë‘”í™”Â·ê²½ê¸° ìš°ë ¤ê°€ ë°˜ì˜ëœ ìˆ˜ì¤€.";
      } else if (wti > 95) {
        score = -2; tag = "off"; level = "ê³ ìœ ê°€ Â· ì¸í”Œë ˆ ì••ë°•";
        comment = "ì¸í”Œë ˆì´ì…˜ê³¼ ê¸ˆë¦¬ ì¬ìƒìŠ¹ ìê·¹ ê°€ëŠ¥.";
      } else {
        score = 0; tag = "neutral"; level = "ì¤‘ë¦½ ë ˆë²¨";
        comment = "íŠ¹ë³„íˆ ê³µê²©/ë°©ì–´ë¥¼ ê°•í•˜ê²Œ ë§Œë“¤ì§„ ì•ŠëŠ” êµ¬ê°„.";
      }
      return {score, tag, level, valueText: "$" + wti.toFixed(1), comment};
    }

    // ========================
    // 3) ë§¤í¬ë¡œ UI ì—…ë°ì´íŠ¸
    // ========================
    function updateIndicatorUI(prefix, evalResult) {
      const tagEl = document.getElementById(`ind-${prefix}-tag`);
      const levelEl = document.getElementById(`ind-${prefix}-level`);
      const valueEl = document.getElementById(`ind-${prefix}-value`);
      const commentEl = document.getElementById(`ind-${prefix}-comment`);

      valueEl.textContent = evalResult.valueText;
      levelEl.textContent = evalResult.level;
      commentEl.textContent = evalResult.comment;

      tagEl.classList.remove("tag-on", "tag-off", "tag-neutral");
      if (evalResult.tag === "on") {
        tagEl.classList.add("tag-on");
        tagEl.textContent = "ê³µê²© ìš°í˜¸";
      } else if (evalResult.tag === "off") {
        tagEl.classList.add("tag-off");
        tagEl.textContent = "ë°©ì–´ ìš°ìœ„";
      } else {
        tagEl.classList.add("tag-neutral");
        tagEl.textContent = "ì¤‘ë¦½";
      }
    }

    function updateMode(score) {
      const modePill = document.getElementById("modePill");
      const modeLabel = document.getElementById("modeLabel");
      const scoreDisplay = document.getElementById("scoreDisplay");
      const summaryText = document.getElementById("summaryText");

      scoreDisplay.textContent = score.toFixed(1);
      modePill.classList.remove("mode-attack", "mode-neutral", "mode-defense");

      if (score >= 4) {
        modePill.classList.add("mode-attack");
        modeLabel.textContent = "ê³µê²© ëª¨ë“œ";
        summaryText.innerHTML =
          "<strong>ë¦¬ìŠ¤í¬-ì˜¨ í™˜ê²½ ìª½ì— ë” ê°€ê¹ë‹¤.</strong> ì„±ì¥ì£¼Â·í…Œí¬Â·ì‹ í¥êµ­ ë¹„ì¤‘ì„ ë†’ì´ëŠ” ê³µê²©ì  í¬ì§€ì…˜ì„ ê³ ë ¤í•  ìˆ˜ ìˆëŠ” ë‚ .";
      } else if (score <= -4) {
        modePill.classList.add("mode-defense");
        modeLabel.textContent = "ë°©ì–´ ëª¨ë“œ";
        summaryText.innerHTML =
          "<strong>ë¦¬ìŠ¤í¬-ì˜¤í”„ í™˜ê²½.</strong> í¬íŠ¸ ë¹„ì¤‘ ì¶•ì†Œ, í˜„ê¸ˆÂ·ë°©ì–´ ì„¹í„°Â·ë°°ë‹¹ì£¼Â·ì±„ê¶Œ, ë¶€ë¶„ í—·ì§€ë¥¼ ì—¼ë‘ì— ë‘¬ì•¼ í•˜ëŠ” êµ¬ê°„.";
      } else {
        modePill.classList.add("mode-neutral");
        modeLabel.textContent = "ì¤‘ë¦½ Â· ì„ íƒì  ê³µê²©";
        summaryText.innerHTML =
          "<strong>ê·¹ë‹¨ì ì¸ ë¦¬ìŠ¤í¬-ì˜¨/ì˜¤í”„ëŠ” ì•„ë‹Œ êµ¬ê°„.</strong> ì§€ìˆ˜ ë°©í–¥ ë² íŒ…ë³´ë‹¤ëŠ” ì„¹í„°Â·ì¢…ëª© ìœ„ì£¼ ì„ íƒì  ê³µê²©/ë°©ì–´ê°€ ì í•©.";
      }
    }

    function updateHorizons(score, vixEval, dxyEval, yieldEval, spreadEval, wtiEval) {
      const hzVeryShort = document.getElementById("hz-very-short");
      const hzShort = document.getElementById("hz-short");
      const hzMidShort = document.getElementById("hz-mid-short");
      const hzMid = document.getElementById("hz-mid");
      const hzMidLong = document.getElementById("hz-mid-long");
      const hzLong = document.getElementById("hz-long");

      const hzVeryShortNote = document.getElementById("hz-very-short-note");
      const hzShortNote = document.getElementById("hz-short-note");
      const hzMidShortNote = document.getElementById("hz-mid-short-note");
      const hzMidNote = document.getElementById("hz-mid-note");
      const hzMidLongNote = document.getElementById("hz-mid-long-note");
      const hzLongNote = document.getElementById("hz-long-note");

      // ì´ˆë‹¨ê¸°: VIX ì¤‘ì‹¬
      if (vixEval.score >= 2) {
        hzVeryShort.textContent = "ìƒìŠ¹ ì¹œí™” (ì €ë³€ë™)";
        hzVeryShortNote.textContent = "ë³€ë™ì„±ì´ ë‚®ì•„ ë¸Œë ˆì´í¬ì•„ì›ƒÂ·ëª¨ë©˜í…€ ì „ëµì— ìš°í˜¸.";
      } else if (vixEval.score <= -2) {
        hzVeryShort.textContent = "ë³€ë™ì„± ê¸‰ë“±";
        hzVeryShortNote.textContent = "ìŠ¤ìœ™ë³´ë‹¨ ë°ì´Â·ìŠ¤ìº˜í•‘, í¬ì§€ì…˜ ì¶•ì†Œ í•„ìš”.";
      } else {
        hzVeryShort.textContent = "ì¤‘ë¦½ ë…¸ì´ì¦ˆ";
        hzVeryShortNote.textContent = "ì§€ìˆ˜ë³´ë‹¨ ê°œë³„ ë‰´ìŠ¤Â·ì‹¤ì  ëª¨ë©˜í…€ ìŠ¹ë¶€.";
      }

      // ë‹¨ê¸°: ì¢…í•© ì ìˆ˜
      if (score >= 4) {
        hzShort.textContent = "ì™„ë§Œí•œ ìƒìŠ¹ ìš°ìœ„";
        hzShortNote.textContent = "1ì£¼ ê¸°ì¤€ ê³µê²© ë¹„ì¤‘ ì‚´ì§ ëŠ˜ë ¤ë³¼ ìˆ˜ ìˆëŠ” êµ¬ê°„.";
      } else if (score <= -4) {
        hzShort.textContent = "í•˜ë½/ì¡°ì • ìš°ìœ„";
        hzShortNote.textContent = "ë°˜ë“±ì€ ë¹„ì¤‘ ì¤„ì´ëŠ” ê¸°íšŒë¡œ ë³´ëŠ” ê²Œ ì•ˆì „.";
      } else {
        hzShort.textContent = "ë°•ìŠ¤ê¶ŒÂ·ì¢…ëª©ì¥";
        hzShortNote.textContent = "ì§€ìˆ˜ ë°©í–¥ì„±ë³´ë‹¨ ì„¹í„° ë¡œí…Œì´ì…˜ì´ í•µì‹¬.";
      }

      // ì¤‘ë‹¨ê¸°: ë‹¬ëŸ¬+ê¸ˆë¦¬+ìœ ê°€
      const midShortScore = dxyEval.score + yieldEval.score + wtiEval.score;
      if (midShortScore >= 3) {
        hzMidShort.textContent = "ì™„ë§Œí•œ ìš°ìƒí–¥ ì‹œë‚˜ë¦¬ì˜¤";
        hzMidShortNote.textContent = "2~4ì£¼ ê¸°ì¤€ ì„±ì¥ì£¼Â·ê²½ê¸°ë¯¼ê° ìš°ìƒí–¥ ì‹œë‚˜ë¦¬ì˜¤ì— ì¡°ê¸ˆ ë” ë¬´ê²Œ.";
      } else if (midShortScore <= -3) {
        hzMidShort.textContent = "ì™„ë§Œí•œ ìš°í•˜í–¥ ì‹œë‚˜ë¦¬ì˜¤";
        hzMidShortNote.textContent = "2~4ì£¼ ì¡°ì • ë¦¬ìŠ¤í¬ ê´€ë¦¬ êµ¬ê°„.";
      } else {
        hzMidShort.textContent = "ë¶ˆí™•ì‹¤Â·ë°•ìŠ¤";
        hzMidShortNote.textContent = "ëšœë ·í•œ ë°©í–¥ì„± ì—†ëŠ” êµ¬ê°„, êµ¬ê°„ë§¤ë§¤ ì¤‘ì‹¬.";
      }

      // ì¤‘ê¸°: ìŠ¤í”„ë ˆë“œ
      if (spreadEval.score >= 2) {
        hzMid.textContent = "ì—°ì°©ë¥™Â·ì™„ë§Œ ì„±ì¥";
        hzMidNote.textContent = "1~3ê°œì›” ê¸°ì¤€ ìš°ìƒí–¥ í™•ë¥ ì´ ìƒëŒ€ì ìœ¼ë¡œ ë†’ì€ êµ¬ì¡°.";
      } else if (spreadEval.score <= -2) {
        hzMid.textContent = "ì¹¨ì²´ ë¦¬ìŠ¤í¬ ë™ë°˜";
        hzMidNote.textContent = "ê²½ê¸° ë‘”í™”Â·ì‹¤ì  í•˜í–¥ ë¦¬ìŠ¤í¬ë¥¼ í•­ìƒ ì—¼ë‘.";
      } else {
        hzMid.textContent = "ì• ë§¤í•œ ì „í™˜ êµ¬ê°„";
        hzMidNote.textContent = "ì¹¨ì²´/ì—°ì°©ë¥™ ì‚¬ì´, ë¶„ì‚°Â·í˜„ê¸ˆ ë¹„ì¤‘ ì¤‘ìš”.";
      }

      // ì¥ë‹¨ê¸°: ìŠ¤í”„ë ˆë“œ+ìœ ê°€
      const midLongScore = spreadEval.score + wtiEval.score;
      if (midLongScore >= 2) {
        hzMidLong.textContent = "ì²œì²œíˆ íšŒë³µ ê¸°ìš¸ê¸°";
        hzMidLongNote.textContent = "3~6ê°œì›” ê¸°ì¤€ í˜„ì¬ ë ˆë²¨ì´ ì¤‘ì¥ê¸° ë°”ë‹¥ì¼ ê°€ëŠ¥ì„±ì— ì¡°ê¸ˆ ë” ë¬´ê²Œ.";
      } else if (midLongScore <= -2) {
        hzMidLong.textContent = "ë³€ë™ì„± í° í•˜í–¥ ì‚¬ì´í´";
        hzMidLongNote.textContent = "ê²½ê¸°/ìœ ê°€ ì´ìŠˆë¡œ ìœ„ì•„ë˜ í¬ê²Œ ì¶œë ì¼ í™•ë¥ .";
      } else {
        hzMidLong.textContent = "ë°©í–¥ì„± ëŒ€ê¸°";
        hzMidLongNote.textContent = "í° ë°©í–¥ í™•ì • ì „ ê¸°ë‹¤ë¦¬ëŠ” êµ¬ê°„.";
      }

      // ì¥ê¸°
      if (spreadEval.score <= -2) {
        hzLong.textContent = "ì¹¨ì²´ í›„ íšŒë³µ(í†±ë‹ˆí˜•)";
        hzLongNote.textContent = "6~12ê°œì›” ê¸°ì¤€ ì¹¨ì²´ â†’ ì™„ë§Œ íšŒë³µ ì‹œë‚˜ë¦¬ì˜¤.";
      } else {
        hzLong.textContent = "ì™„ë§Œí•œ ìš°ìƒí–¥(ì¥ê¸°)";
        hzLongNote.textContent = "êµ¬ì¡°ì  ì¸í”Œë ˆÂ·ê³µê¸‰ ì œì•½ ê³ ë ¤ ì‹œ ì¥ê¸°ì  ì™„ë§Œ ìš°ìƒí–¥ ê°€ì •.";
      }
    }

    function updateChips(score) {
      const row = document.getElementById("chipsRow");
      row.innerHTML = "";

      const makeChip = (label, text) => {
        const div = document.createElement("div");
        div.className = "chip";
        div.innerHTML = `<span>${label}</span>â€“ ${text}`;
        return div;
      };

      if (score >= 4) {
        row.appendChild(makeChip("ì´ˆë‹¨ê¸°", "í—¤ì§€ ë‘ê³  ë¸Œë ˆì´í¬ì•„ì›ƒ/ëª¨ë©˜í…€ ê³µê²© ê°€ëŠ¥"));
        row.appendChild(makeChip("ë‹¨ê¸°", "ì„±ì¥ì£¼Â·í…Œí¬ ë¹„ì¤‘ ì¡°ê¸ˆ ëŠ˜ë¦¬ëŠ” êµ¬ê°„"));
        row.appendChild(makeChip("ì¤‘ë‹¨ê¸°", "ì§€í‘œ ë°œí‘œ ì•ë‘ê³¤ ë¹„ì¤‘ ì¡°ì ˆ í•„ìˆ˜"));
      } else if (score <= -4) {
        row.appendChild(makeChip("ì´ˆë‹¨ê¸°", "í˜„ê¸ˆÂ·í—·ì§€ ë¹„ì¤‘ ìš°ì„ , í¬ì§€ì…˜ ì¶•ì†Œ"));
        row.appendChild(makeChip("ë‹¨ê¸°", "ë°˜ë“±ì€ ë¹„ì¤‘ ì¤„ì´ëŠ” ê¸°íšŒ"));
        row.appendChild(makeChip("ì¤‘ë‹¨ê¸°", "ì¡°ì • ê¸¸ì–´ì§ˆ ìˆ˜ ìˆì–´ ì„¹í„° ë¶„ì‚° í•„ìˆ˜"));
      } else {
        row.appendChild(makeChip("ì´ˆë‹¨ê¸°", "ë‰´ìŠ¤Â·ì‹¤ì  ëª¨ë©˜í…€ ìœ„ì£¼ ì¢…ëª© ì¥ì„¸"));
        row.appendChild(makeChip("ë‹¨ê¸°", "ê³µê²©/ë°©ì–´ ë‘˜ ë‹¤ â€˜ì ˆë°˜ë§Œâ€™"));
        row.appendChild(makeChip("ì¤‘ë‹¨ê¸°", "ë°©í–¥ ë² íŒ…ë³´ë‹¨ êµ¬ê°„ë§¤ë§¤Â·í˜„ê¸ˆ ê´€ë¦¬"));
      }
    }

    function updateExtremeBanner() {
      const box = document.getElementById("extremeBanner");
      const titleEl = document.getElementById("extremeBannerTitle");
      const textEl = document.getElementById("extremeBannerText");
      if (!box || !titleEl || !textEl) return;

      const macro = lastMacroScore;
      const oil = lastOilScore;

      // ê¸°ë³¸ ìˆ¨ê¹€
      box.style.display = "none";

      // ê³¼ì—´ / ê³¼ë§¤ë„ ì¡°ê±´
      if (macro >= 8 || oil >= 4) {
        box.style.display = "block";
        titleEl.textContent = "âš  ê³¼ì—´ êµ¬ê°„ â€“ ì¶”ê²©ë³´ë‹¤ ë¶„í•  ì²­ì‚°Â·ì—­ì¶”ì„¸ í›„ë³´";
        textEl.textContent =
          "ë§¤í¬ë¡œÂ·ìœ ê°€ ì ìˆ˜ê°€ ê³¼ì—´ ìª½ì— ì¹˜ìš°ì¹œ ìƒíƒœ. ì¶”ê²© ë§¤ìˆ˜ë³´ë‹¤ëŠ” ë¶„í•  ì²­ì‚°ê³¼ ë‹¨ê¸° ì—­ì¶”ì„¸Â·ì¡°ì • êµ¬ê°„ì„ ì—¼ë‘ì— ë‘ëŠ” í¸ì´ ì•ˆì „í•œ ë‚ .";
      } else if (macro <= -8 || oil <= -4) {
        box.style.display = "block";
        titleEl.textContent = "âš  ê³¼ë§¤ë„ êµ¬ê°„ â€“ íŒ¨ë‹‰ ì €ì  ì¶”ê²© ê¸ˆì§€";
        textEl.textContent =
          "ê³µí¬Â·ê³¼ë§¤ë„ êµ¬ê°„ì— ê°€ê¹Œìš´ ìƒíƒœ. íŒ¨ë‹‰ ì†ì—ì„œ ì €ì ì„ ì¶”ê²©í•˜ê¸°ë³´ë‹¤, ë°˜ë“± êµ¬ê°„ì—ì„œ ë‹¨ê³„ì  ì§„ì…ì´ë‚˜ ìŠ¤ìœ™ ê´€ì ì˜ ë§¤ë§¤ê°€ ë” ìœ ë¦¬í•  ìˆ˜ ìˆëŠ” í™˜ê²½.";
      }
    }

    function recalc() {
      const vix = parse(document.getElementById("vix").value);
      const dxy = parse(document.getElementById("dxy").value);
      const y10 = parse(document.getElementById("yield10").value);
      const spread = parse(document.getElementById("spread").value);
      const wti = parse(document.getElementById("wti").value);

      const vixEval = evalVix(vix);
      const dxyEval = evalDxy(dxy);
      const yieldEval = evalYield10(y10);
      const spreadEval = evalSpread(spread);
      const wtiEval = evalWti(wti);

      updateIndicatorUI("vix", vixEval);
      updateIndicatorUI("dxy", dxyEval);
      updateIndicatorUI("yield", yieldEval);
      updateIndicatorUI("spread", spreadEval);
      updateIndicatorUI("wti", wtiEval);

      const totalScore = vixEval.score + dxyEval.score + yieldEval.score + spreadEval.score + wtiEval.score;
      lastMacroScore = totalScore;

      updateMode(totalScore);
      updateHorizons(totalScore, vixEval, dxyEval, yieldEval, spreadEval, wtiEval);
      updateChips(totalScore);

      // ë§¤í¬ë¡œ ì¬ê³„ì‚° í›„ ìœ ê°€ ëª¨ë“ˆë„ ê°™ì´ ì—…ë°ì´íŠ¸
      updateOilSection();
    }

    document.getElementById("calcBtn").addEventListener("click", recalc);

    document.getElementById("demoBtn").addEventListener("click", () => {
      // ì˜ˆì‹œ ê°’
      document.getElementById("vix").value = "15.4";
      document.getElementById("dxy").value = "99.0";
      document.getElementById("yield10").value = "4.01";
      document.getElementById("spread").value = "-38";
      document.getElementById("wti").value = "60.1";

      document.getElementById("brent").value = "64.5";
      document.getElementById("rbob").value = "2.35";
      document.getElementById("heat").value = "2.80";

      document.getElementById("eiaCrude").value = "3.5";
      document.getElementById("eiaGas").value = "-1.2";
      document.getElementById("eiaDist").value = "0.8";

      recalc();
    });

    // ========================
    // 4) êµ¬ê¸€ ì‹œíŠ¸ Web App ì—°ë™
    // ========================
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzdQGzk5TUiLLnUwVR7-kbyhtKufoF0ap1TeABt14wx8dExrsycqAzE5cdHQROACv3v/exec";
    // ë©”ëª¨/append ì „ìš© URL (Apps Scriptì—ì„œ ?mode=append ì²˜ë¦¬í•˜ë„ë¡ êµ¬ì„±í•˜ë©´ ë¨)
    const MEMO_WEB_APP_URL = WEB_APP_URL + "?mode=append";

    document.getElementById("loadBtn").addEventListener("click", async () => {
      try {
        const res = await fetch(WEB_APP_URL, { method: "GET" });
        if (!res.ok) {
          alert("ì‹œíŠ¸ Web App í˜¸ì¶œ ì‹¤íŒ¨: " + res.status);
          return;
        }
        const data = await res.json();
        if (data.error) {
          alert("ì‹œíŠ¸ ë°ì´í„° ì˜¤ë¥˜: " + (data.message || ""));
          return;
        }

        if (data.vix != null) document.getElementById("vix").value = data.vix;
        if (data.dxy != null) document.getElementById("dxy").value = data.dxy;
        if (data.yield10 != null) document.getElementById("yield10").value = data.yield10;
        if (data.spread != null) document.getElementById("spread").value = data.spread;
        if (data.wti != null) document.getElementById("wti").value = data.wti;
if (data.brent != null) document.getElementById("brent").value = data.brent;
if (data.rbob != null) document.getElementById("rbob").value = data.rbob;
if (data.heat != null) document.getElementById("heat").value = data.heat;
if (data.eiaCrude != null) document.getElementById("eiaCrude").value = data.eiaCrude;
if (data.eiaGas != null) document.getElementById("eiaGas").value = data.eiaGas;
if (data.eiaDist != null) document.getElementById("eiaDist").value = data.eiaDist;

        recalc();
      } catch (err) {
        console.error(err);
        alert("Web App í˜¸ì¶œ ì¤‘ ì—ëŸ¬ ë°œìƒ. ì½˜ì†”ì„ í™•ì¸í•´ì¤˜.");
      }
    });

    // ========================
    // 5) ìœ ê°€ ëª¨ë“ˆ ê³„ì‚° ë¡œì§
    // ========================
    function calcNetInventory(crude, gasoline, distillate) {
      const c = parse(crude);
      const g = parse(gasoline);
      const d = parse(distillate);
      if (c === null && g === null && d === null) return null;
      return (c || 0) + (g || 0) + (d || 0);
    }

    function calcCrackSpread(wti, rbob, ho) {
      const W = parse(wti);
      const R = parse(rbob);
      const H = parse(ho);
      if (W === null || R === null || H === null) return null;
      return 2 * R + H - 3 * W;
    }

    function calcWtiBrent(wti, brent) {
      const W = parse(wti);
      const B = parse(brent);
      if (W === null || B === null) return null;
      return W - B;
    }

    function oilScoreEvaluator(spread, crack, netInv) {
      if (spread === null || crack === null || netInv === null) {
        return { score: 0, label: "ë°ì´í„° ë¶€ì¡±", desc: "ì¼ë¶€ ì§€í‘œê°€ ì—†ì–´ ìœ ê°€ ì ìˆ˜ ê³„ì‚° ë¶ˆê°€." };
      }

      let score = 0;

      // ìŠ¤í”„ë ˆë“œ
      if (spread > 5) score += -1;
      else if (spread < -3) score += 1;

      // Crack
      if (crack > 25) score += 2;
      else if (crack > 15) score += 1;
      else if (crack < 5) score -= 1;

      // ì¬ê³ 
      if (netInv > 2) score -= 2;
      else if (netInv < -2) score += 1;

      let label, desc;
      if (score >= 3) {
        label = "ê°•í•œ ìƒìŠ¹ ìš°ìœ„ (ê³µê²©)";
        desc = "ìˆ˜ìš” ê°•ì„¸/Crack í˜¸ì¡°ë¡œ ìœ ê°€ ìƒìŠ¹ ìª½ í™•ë¥  ìš°ìœ„.";
      } else if (score <= -3) {
        label = "í•˜ë½/ì¡°ì • ìš°ìœ„ (ë°©ì–´)";
        desc = "ì¬ê³  ì¦ê°€Â·ìŠ¤í”„ë ˆë“œ ì•…í™”ë¡œ ë‹¨ê¸° í•˜ë½ì••ë ¥ ìš°ìœ„.";
      } else {
        label = "ì¤‘ë¦½/ë ˆì¸ì§€";
        desc = "ëª…í™•í•œ ë°©í–¥ ì—†ì´ ë ˆì¸ì§€ ê°€ëŠ¥ì„±ì´ í° êµ¬ê°„.";
      }
      return { score, label, desc };
    }

    function updateOilActionBox(result) {
      const titleEl = document.getElementById("oilActionTitle");
      const textEl = document.getElementById("oilActionText");
      if (!titleEl || !textEl) return;

      const s = result.score;

      if (s >= 3) {
        titleEl.textContent = "ë¡± ìš°ìœ„ Â· ì¡°ì • ë§¤ìˆ˜ ìŠ¤íƒ ìŠ¤";
        textEl.textContent =
          "ìœ ê°€ ì ìˆ˜ê°€ ìƒìŠ¹ ìš°ìœ„ êµ¬ê°„. ì¶”ê²© ë§¤ìˆ˜ë³´ë‹¤ëŠ” intraday ì¡°ì •Â·ëˆŒë¦¼ì„ ê¸°ë‹¤ë ¸ë‹¤ê°€ ë¡± ì§„ì…, ë˜ëŠ” ì½œÂ·ë¶ˆìŠ¤í”„ë ˆë“œ ìœ„ì£¼ ì „ëµì´ ìœ ë¦¬í•œ í™˜ê²½.";
      } else if (s <= -3) {
        titleEl.textContent = "ìˆ ìš°ìœ„ Â· ë°˜ë“± ë§¤ë„ ìŠ¤íƒ ìŠ¤";
        textEl.textContent =
          "ìœ ê°€ ì ìˆ˜ê°€ í•˜ë½/ì¡°ì • ìš°ìœ„ êµ¬ê°„. ì¶”ì„¸ í•˜ë½ ë™í–‰ ë˜ëŠ” ë‹¨ê¸° ë°˜ë“± êµ¬ê°„ì—ì„œ ìˆÂ·í’‹Â·ë² ì–´ìŠ¤í”„ë ˆë“œ ì „ëµì„ ìš°ì„  ê²€í† í•˜ëŠ” ë‚ .";
      } else {
        titleEl.textContent = "ê´€ë§Â·ìŠ¤ìº˜í•‘ ì¤‘ì‹¬ ìŠ¤íƒ ìŠ¤";
        textEl.textContent =
          "ìœ ê°€ ì ìˆ˜ê°€ ëª…í™•í•œ ë°©í–¥ì„ ì£¼ì§€ ì•ŠëŠ” ë ˆì¸ì§€ êµ¬ê°„ì¼ ê°€ëŠ¥ì„±. ê³¼ë„í•œ ë°©í–¥ ë² íŒ…ë³´ë‹¤ ìŠ¤ìº˜í•‘Â·ë‹¨íƒ€Â·ë ˆì¸ì§€ ìƒë‹¨/í•˜ë‹¨ ìœ„ì£¼ ê³µë°©ì´ ì í•©í•œ í™˜ê²½.";
      }
    }

    function updateOilStrategyText(spread, crack, netInv) {
      const el = document.getElementById("oilStrategyText");
      if (!el) return;

      if (spread === null && crack === null && netInv === null) {
        el.textContent = "WTI/Brent Â· Crack Â· ì¬ê³ ë¥¼ ì…ë ¥í•˜ë©´, ì •ìœ Â·ì—ë„ˆì§€ ì„¹í„°ì™€ ìŠ¤í”„ë ˆë“œ íŠ¸ë ˆì´ë”©ì— ëŒ€í•œ ê¸°ë³¸ ì „ëµ íŒíŠ¸ë¥¼ ìë™ìœ¼ë¡œ ìš”ì•½í•´ì¤€ë‹¤.";
        return;
      }

      let lines = [];

      // ìŠ¤í”„ë ˆë“œ
      if (spread !== null) {
        if (spread > 5) {
          lines.push("WTIê°€ Brent ëŒ€ë¹„ ê³ í‰ê°€ëœ êµ¬ê°„. ë¯¸êµ­ ë‚´ íƒ€ì´íŠ¸/ê³µê¸‰ ì´ìŠˆ ê°€ëŠ¥ì„±ì´ ìˆì–´ ë¸Œë ŒíŠ¸ ëŒ€ë¹„ ë¡±ìŠ¤í”„ë ˆë“œë³´ë‹¤ëŠ”, ë‹¨ê¸° ì¡°ì • ë¦¬ìŠ¤í¬ë„ í•¨ê»˜ ì²´í¬í•´ì•¼ í•˜ëŠ” êµ¬ê°„.");
        } else if (spread < -3) {
          lines.push("WTIê°€ Brentë³´ë‹¤ ì €í‰ê°€ëœ ë””ìŠ¤ì¹´ìš´íŠ¸ êµ¬ê°„. ë¯¸êµ­ ë‚´ ê³µê¸‰ ì—¬ìœ Â·ìˆ˜ìš” ë‘”í™”ê°€ ë°˜ì˜ë˜ì—ˆì„ ìˆ˜ ìˆìœ¼ë©°, WTI ê°•ì„¸ë¡œ ë˜ëŒë¦¬ëŠ” ë¦¬ë²„ì „ íŠ¸ë ˆì´ë“œ í›„ë³´ê°€ ë  ìˆ˜ ìˆë‹¤.");
        } else {
          lines.push("WTI/Brent ìŠ¤í”„ë ˆë“œëŠ” ëŒ€ì²´ë¡œ ì¤‘ë¦½ ë²”ìœ„. ë°©í–¥ì„±ë³´ë‹¤ëŠ” ì „ì²´ ì—ë„ˆì§€ ì„¹í„° ë² íƒ€ì— ì§‘ì¤‘í•˜ëŠ” í¸ì´ ì¢‹ë‹¤.");
        }
      }

      // Crack
      if (crack !== null) {
        if (crack > 25) {
          lines.push("3-2-1 Crackì´ ë§¤ìš° ë†’ì€ ìˆ˜ì¤€. ì •ìœ  ë§ˆì§„ì´ ì¢‹ê¸° ë•Œë¬¸ì— ì •ìœ ì‚¬Â·ì—ë„ˆì§€ ì„¹í„° ë¡±, ë˜ëŠ” ìœ ê°€ ë¡±ê³¼ì˜ ì¡°í•© ì „ëµì„ ìš°ì„ ì ìœ¼ë¡œ ê³ ë ¤í•  ë§Œí•˜ë‹¤.");
        } else if (crack > 15) {
          lines.push("ì •ìœ  ë§ˆì§„ì´ ì–‘í˜¸í•œ êµ¬ê°„ìœ¼ë¡œ, ìœ ê°€Â·ì—ë„ˆì§€ ì„¹í„°ì— ìš°í˜¸ì ì¸ í™˜ê²½. ë‹¤ë§Œ ê³¼ì—´ ì—¬ë¶€ëŠ” ë³„ë„ë¡œ ì²´í¬ í•„ìš”.");
        } else if (crack < 5) {
          lines.push("Crackì´ ë§¤ìš° ë‚®ì€ êµ¬ê°„. ìˆ˜ìš” ë‘”í™”Â·ë§ˆì§„ ì••ë°•ì´ ë°˜ì˜ëœ ìƒíƒœë¡œ, ì •ìœ ì£¼/ì—ë„ˆì§€ ì„¹í„°ëŠ” ë°©ì–´ì  ìŠ¤íƒ ìŠ¤ê°€ ìœ ë¦¬í•  ìˆ˜ ìˆë‹¤.");
        } else {
          lines.push("Crack ìŠ¤í”„ë ˆë“œëŠ” ë³´í†µ ìˆ˜ì¤€. ìœ ê°€ ìì²´ì˜ ë°©í–¥ë³´ë‹¤ëŠ” ì§€ìˆ˜Â·ì„¹í„° íšŒì „ê³¼ í•¨ê»˜ ë³´ëŠ” í¸ì´ ì¢‹ë‹¤.");
        }
      }

      // ì¬ê³ 
      if (netInv !== null) {
        if (netInv > 2) {
          lines.push("ìˆœì¬ê³ ê°€ ì˜ë¯¸ ìˆê²Œ ì¦ê°€(ë¹Œë“œ)í•œ ìƒíƒœë¼ ë‹¨ê¸°ì ìœ¼ë¡œ ìœ ê°€ ìƒë‹¨ì´ ëˆŒë¦´ ìˆ˜ ìˆëŠ” êµ¬ê°„.");
        } else if (netInv < -2) {
          lines.push("ìˆœì¬ê³ ê°€ ê°•í•˜ê²Œ ë“œë¡œìš°ëœ ìƒíƒœë¡œ, ë‹¨ê¸° ìƒë°© ì••ë ¥ì´ ì´ì–´ì§ˆ ìˆ˜ ìˆëŠ” í™˜ê²½.");
        } else {
          lines.push("ìˆœì¬ê³  ë³€í™”ëŠ” í¬ì§€ ì•Šì•„, ì¬ê³  ìš”ì¸ì€ ì¤‘ë¦½ì— ê°€ê¹ë‹¤.");
        }
      }

      el.textContent = lines.join(" ");
    }

    function updateEiaComments(netInv) {
      const toggle = document.getElementById("eiaModeToggle");
      const preEl = document.getElementById("eiaPreText");
      const postEl = document.getElementById("eiaPostText");
      if (!toggle || !preEl || !postEl) return;

      if (!toggle.checked) {
        preEl.textContent = "EIA ëª¨ë“œë¥¼ ì¼œë©´ í˜„ì¬ ë§¤í¬ë¡œ/ìœ ê°€ ì ìˆ˜ ê¸°ì¤€ìœ¼ë¡œ ë°œí‘œ ì „ ê¸°ë³¸ ìŠ¤íƒ ìŠ¤ë¥¼ ìš”ì•½í•´ì¤€ë‹¤.";
        postEl.textContent = "ì¬ê³  ì…ë ¥ í›„, ìˆœì¬ê³  ë°©í–¥ê³¼ ìœ ê°€ ì ìˆ˜ë¥¼ ë°˜ì˜í•œ ë°œí‘œ í›„ í†¤ì„ ìš”ì•½í•´ì¤€ë‹¤.";
        return;
      }

      // ë°œí‘œ ì „: ë§¤í¬ë¡œ/ìœ ê°€ ì ìˆ˜ ê¸°ë°˜
      if (lastMacroScore >= 4 || lastOilScore >= 3) {
        preEl.textContent =
          "ë°œí‘œ ì „ ê¸°ì¤€ìœ¼ë¡œëŠ” ë¦¬ìŠ¤í¬-ì˜¨Â·ìœ ê°€ ìƒë°© ìª½ì— ì¡°ê¸ˆ ë” ê¸°ìš¸ì–´ ìˆëŠ” í™˜ê²½. ë‹¤ë§Œ EIAì—ì„œ í° ë¹Œë“œê°€ ë‚˜ì˜¤ë©´ ë¶„ìœ„ê¸°ê°€ ë¹ ë¥´ê²Œ êº¾ì¼ ìˆ˜ ìˆì–´, ë°œí‘œ ì§ì „ ê³¼ë„í•œ ë¡± ë² íŒ…ì€ ìì œí•˜ëŠ” í¸ì´ ì¢‹ë‹¤.";
      } else if (lastMacroScore <= -4 || lastOilScore <= -3) {
        preEl.textContent =
          "ì´ë¯¸ ë¦¬ìŠ¤í¬-ì˜¤í”„Â·ìœ ê°€ í•˜ë°© ìª½ìœ¼ë¡œ ê¸°ìš¸ì–´ì§„ ìƒíƒœ. ë°œí‘œì—ì„œ ì¶”ê°€ ë¹Œë“œê°€ ë‚˜ì˜¤ë©´ í•˜ë½ì´ ê³¼ì¥ë  ìˆ˜ ìˆê³ , ê°•í•œ ë“œë¡œìš°ê°€ ë‚˜ì˜¤ë©´ ìˆ ì»¤ë²„ êµ¬ê°„ì´ ë‚˜ì˜¬ ìˆ˜ ìˆì–´ ì–‘ ë°©í–¥ ë³€ë™ì„± í™•ëŒ€ì— ëŒ€ë¹„í•´ì•¼ í•˜ëŠ” ë‚ .";
      } else {
        preEl.textContent =
          "ë§¤í¬ë¡œÂ·ìœ ê°€ ì ìˆ˜ê°€ ì¤‘ë¦½ì— ê°€ê¹Œìš´ ìƒíƒœ. EIA ë°œí‘œ ê²°ê³¼ì— ë”°ë¼ ë°©í–¥ì´ ì •í•´ì§ˆ ìˆ˜ ìˆëŠ” êµ¬ê°„ì´ë¼, ë°œí‘œ ì „ì—ëŠ” í¬ì§€ì…˜ ì‚¬ì´ì¦ˆë¥¼ í‰ì†Œë³´ë‹¤ ì¤„ì´ê±°ë‚˜, ì´ë²¤íŠ¸ ì§í›„ ë¦¬ì•¡ì…˜ì„ ë³´ê³  ì§„ì…í•˜ëŠ” ì „ëµì´ ìœ ë¦¬í•˜ë‹¤.";
      }

      // ë°œí‘œ í›„: ì¬ê³  ì…ë ¥ ê¸°ë°˜
      if (netInv === null) {
        postEl.textContent = "ì¬ê³  ê°’ì´ ì•„ì§ ì…ë ¥ë˜ì§€ ì•Šì•„, ë°œí‘œ í›„ ë·°ë¥¼ ê³„ì‚°í•  ìˆ˜ ì—†ë‹¤. CrudeÂ·íœ˜ë°œìœ Â·ë””ì ¤ ì¬ê³  ë³€í™”ë¥¼ ì…ë ¥í•œ ë’¤ ë‹¤ì‹œ í™•ì¸í•´ì¤˜.";
      } else if (netInv > 2) {
        postEl.textContent =
          "ì‹¤ì œ ë°œí‘œ ê²°ê³¼, ìˆœì¬ê³ ê°€ ì˜ë¯¸ ìˆê²Œ ë¹Œë“œëœ ìƒíƒœ. ë‹¨ê¸°ì ìœ¼ë¡œ ìœ ê°€ ìƒë‹¨ì´ ëˆŒë¦´ ìˆ˜ ìˆëŠ” í™˜ê²½ìœ¼ë¡œ, ì²« 5~15ë¶„ ë¦¬ì•¡ì…˜ì„ í™•ì¸í•œ ë’¤ ë°˜ë“± êµ¬ê°„ì—ì„œ ìˆ/ì½œì²­ì‚° ìª½ìœ¼ë¡œ ì ‘ê·¼í•˜ëŠ” ì „ëµì„ ìš°ì„  ê²€í† í•  ë§Œí•˜ë‹¤.";
      } else if (netInv < -2) {
        postEl.textContent =
          "ì‹¤ì œ ë°œí‘œ ê²°ê³¼, ìˆœì¬ê³ ê°€ ê°•í•˜ê²Œ ë“œë¡œìš°ëœ ìƒíƒœ. ìƒë°© ëª¨ë©˜í…€Â·ìˆ ì»¤ë²„ê°€ ë‚˜ì˜¬ ìˆ˜ ìˆëŠ” í™˜ê²½ìœ¼ë¡œ, ê¸‰ë“± êµ¬ê°„ì—ì„œëŠ” ì¶”ê²©ë³´ë‹¤ ë¶„í•  ë§¤ë„/ì°¨ìµì‹¤í˜„, ëˆŒë¦¼ êµ¬ê°„ì—ì„œëŠ” ìŠ¤ìœ™ ë¡± ì§„ì…ì„ ê²€í† í•  ìˆ˜ ìˆëŠ” ë‚ .";
      } else {
        postEl.textContent =
          "ìˆœì¬ê³  ë³€í™”ê°€ í¬ì§€ ì•Šì€ ì¤‘ë¦½ì ì¸ ë°œí‘œ. ìœ ê°€ ë°©í–¥ì€ ì¬ê³ ë³´ë‹¤ëŠ” ë‹¬ëŸ¬Â·ê¸ˆë¦¬Â·ë¦¬ìŠ¤í¬ ìì‚° ì „ì²´ íë¦„ì— ë” ì˜í–¥ì„ ë°›ì„ ìˆ˜ ìˆëŠ” êµ¬ê°„.";
      }
    }

    // EIA ë¯¸ë‹ˆ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
    function updateEiaMiniChart(crude, gas, dist, net) {
      const rawC = parse(crude);
      const rawG = parse(gas);
      const rawD = parse(dist);
      const rawN = net;

      const vals = [rawC, rawG, rawD, rawN].filter(v => v !== null);
      const maxAbs = vals.length ? Math.max(...vals.map(v => Math.abs(v))) : 0;

      function setBar(idBar, idVal, value) {
        const bar = document.getElementById(idBar);
        const valEl = document.getElementById(idVal);
        if (!bar || !valEl) return;

        if (value === null || maxAbs === 0) {
          bar.style.width = "0%";
          bar.style.transform = "translateX(0)";
          bar.className = "eia-bar";
          valEl.textContent = "-";
          return;
        }

        const widthPct = Math.min(Math.abs(value) / maxAbs * 100, 100);
        bar.style.width = widthPct + "%";

        // ê°€ìš´ë°(50%) ê¸°ì¤€ìœ¼ë¡œ ì¢Œìš°
        if (value >= 0) {
          bar.style.left = "50%";
          bar.style.transform = "translateX(0)";
          bar.className = "eia-bar eia-bar-positive";
        } else {
          bar.style.left = "50%";
          bar.style.transform = `translateX(-${widthPct}%)`;
          bar.className = "eia-bar eia-bar-negative";
        }

        const sign = value > 0 ? "+" : "";
        valEl.textContent = sign + value.toFixed(1);
      }

      setBar("eiaBarCrude", "eiaValCrude", rawC);
      setBar("eiaBarGas", "eiaValGas", rawG);
      setBar("eiaBarDist", "eiaValDist", rawD);
      setBar("eiaBarNet", "eiaValNet", rawN);
    }

    function updateOilSection() {
      const wti = document.getElementById("wti").value;
      const brent = document.getElementById("brent").value;
      const rbob = document.getElementById("rbob").value;
      const ho = document.getElementById("heat").value;

      const crude = document.getElementById("eiaCrude").value;
      const gas = document.getElementById("eiaGas").value;
      const dist = document.getElementById("eiaDist").value;

      const net = calcNetInventory(crude, gas, dist);
      const spread = calcWtiBrent(wti, brent);
      const crack = calcCrackSpread(wti, rbob, ho);

      const invNetText = document.getElementById("invNetText");
      const invComment = document.getElementById("invComment");
      const spreadValueText = document.getElementById("spreadValueText");
      const spreadComment = document.getElementById("spreadComment");
      const crackValueText = document.getElementById("crackValueText");
      const crackComment = document.getElementById("crackComment");
      const scorePill = document.getElementById("oilScorePill");
      const scoreLabel = document.getElementById("oilScoreLabel");
      const scoreNumber = document.getElementById("oilScoreNumber");
      const scoreComment = document.getElementById("oilScoreComment");

      // ìˆœì¬ê³ 
      if (net === null) {
        invNetText.textContent = "-";
        invComment.textContent = "ì¬ê³  3ê°œ ì¤‘ í•˜ë‚˜ ì´ìƒ ì…ë ¥í•˜ë©´ ìˆœì¬ê³  ë°©í–¥ì´ í‘œì‹œëœë‹¤.";
      } else {
        const v = net.toFixed(1);
        invNetText.textContent = (net > 0 ? "+" : "") + v + " mbbl";
        if (net > 2) {
          invComment.textContent = "ìˆœì¬ê³  ì¦ê°€(ë¹Œë“œ) â†’ ìœ ê°€ì— í•˜ë°© ì••ë ¥.";
        } else if (net < -2) {
          invComment.textContent = "ìˆœì¬ê³  ê°ì†Œ(ë“œë¡œìš°) â†’ ìœ ê°€ì— ìƒë°© ì••ë ¥.";
        } else {
          invComment.textContent = "ìˆœì¬ê³  ë³€í™”ê°€ í¬ì§€ ì•Šì•„ ì¬ê³  ìš”ì¸ì€ ì¤‘ë¦½.";
        }
      }

      // ë¯¸ë‹ˆ ì°¨íŠ¸ ê°±ì‹ 
      updateEiaMiniChart(crude, gas, dist, net);

      // ìŠ¤í”„ë ˆë“œ
      if (spread === null) {
        spreadValueText.textContent = "-";
        spreadComment.textContent = "WTI/Brent ê°€ê²©ì„ ì…ë ¥í•˜ë©´ ìŠ¤í”„ë ˆë“œê°€ í‘œì‹œëœë‹¤.";
      } else {
        const v = spread.toFixed(2);
        spreadValueText.textContent = (spread > 0 ? "+" : "") + v + " $/bbl";
        if (spread > 5) {
          spreadComment.textContent = "WTIê°€ ìƒëŒ€ì ìœ¼ë¡œ ë¹„ì‹¼ êµ¬ê°„ â†’ ë¯¸êµ­ ë‚´ íƒ€ì´íŠ¸/ê³µê¸‰ ì´ìŠˆ ê°€ëŠ¥.";
        } else if (spread < -3) {
          spreadComment.textContent = "WTIê°€ Brentë³´ë‹¤ ì €ë ´ â†’ ë¯¸êµ­ ë‚´ ê³µê¸‰ ì—¬ìœ  ë˜ëŠ” ìˆ˜ìš” ë‘”í™”.";
        } else {
          spreadComment.textContent = "WTI/Brent ìŠ¤í”„ë ˆë“œëŠ” ëŒ€ì²´ë¡œ ì¤‘ë¦½ ë²”ìœ„.";
        }
      }

      // Crack
      if (crack === null) {
        crackValueText.textContent = "-";
        crackComment.textContent = "WTI Â· RBOB Â· HOë¥¼ ì…ë ¥í•˜ë©´ 3-2-1 Crackì´ ê³„ì‚°ëœë‹¤.";
      } else {
        const v = crack.toFixed(2);
        crackValueText.textContent = v + " $/bbl";
        if (crack > 25) {
          crackComment.textContent = "ì •ìœ  ë§ˆì§„ì´ ë§¤ìš° ì¢‹ì€ êµ¬ê°„ â†’ ì •ìœ ì‚¬/ì—ë„ˆì§€ ì„¹í„°ì— ìš°í˜¸.";
        } else if (crack > 15) {
          crackComment.textContent = "ì •ìœ  ë§ˆì§„ì´ ì–‘í˜¸í•œ êµ¬ê°„ â†’ ìœ ê°€/ì—ë„ˆì§€ì— ìš°í˜¸ì .";
        } else if (crack < 5) {
          crackComment.textContent = "ì •ìœ  ë§ˆì§„ì´ ì•½í•œ êµ¬ê°„ â†’ ìˆ˜ìš” ë‘”í™”/ë§ˆì§„ ì••ë°• ì‹ í˜¸.";
        } else {
          crackComment.textContent = "í¬ë™ ìŠ¤í”„ë ˆë“œëŠ” ë³´í†µ ìˆ˜ì¤€.";
        }
      }

      // ìœ ê°€ ì ìˆ˜
      const result = oilScoreEvaluator(spread, crack, net);
      lastOilScore = result.score;

      scoreNumber.textContent = result.score.toFixed(1);
      scoreLabel.textContent = result.label;
      scoreComment.textContent = result.desc;

      scorePill.classList.remove("oil-bull", "oil-bear", "oil-neutral");
      if (result.score >= 3) {
        scorePill.classList.add("oil-bull");
      } else if (result.score <= -3) {
        scorePill.classList.add("oil-bear");
      } else {
        scorePill.classList.add("oil-neutral");
      }

      // ìœ ê°€ ë§¤ë§¤ ì•¡ì…˜ ìš”ì•½
      updateOilActionBox(result);

      // ìŠ¤í”„ë ˆë“œ/Crack ì „ëµ í…ìŠ¤íŠ¸
      updateOilStrategyText(spread, crack, net);

      // EIA ë°œí‘œ ì „/í›„ ì½”ë©˜íŠ¸
      updateEiaComments(net);

      // ê³¼ì—´/ê³¼ë§¤ë„ ë°°ë„ˆ
      updateExtremeBanner();
    }

    document.getElementById("oilCalcBtn").addEventListener("click", updateOilSection);
    document.getElementById("eiaModeToggle").addEventListener("change", () => {
      // ëª¨ë“œ í† ê¸€ë§Œ ë°”ë€Œì–´ë„ ì½”ë©˜íŠ¸ ì—…ë°ì´íŠ¸
      const crude = document.getElementById("eiaCrude").value;
      const gas = document.getElementById("eiaGas").value;
      const dist = document.getElementById("eiaDist").value;
      const net = calcNetInventory(crude, gas, dist);
      updateEiaComments(net);
    });

    // ========================
    // 6) í¬ì§€ì…˜ ì‚¬ì´ì¦ˆ & ì†ìµë¹„ ê³„ì‚°ê¸°
    // ========================
    function calcPositionSize() {
      const equity = parse(document.getElementById("psEquity").value);
      const riskPct = parse(document.getElementById("psRiskPct").value);
      const entry = parse(document.getElementById("psEntry").value);
      const stop = parse(document.getElementById("psStop").value);
      const target = parse(document.getElementById("psTarget").value);
      const inst = document.getElementById("psInstrument").value;

      const mainEl = document.getElementById("psResultMain");
      const detailEl = document.getElementById("psResultDetail");

      if (equity === null || riskPct === null || entry === null || stop === null || target === null) {
        mainEl.textContent = "ìë³¸, ë¦¬ìŠ¤í¬ %, ì§„ì…Â·ì†ì ˆÂ·ëª©í‘œê°€ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì¤˜.";
        detailEl.textContent = "";
        return;
      }
      if (entry === stop) {
        mainEl.textContent = "ì§„ì…ê°€ì™€ ì†ì ˆê°€ê°€ ê°™ìœ¼ë©´ ì•ˆ ë¼. ì†ì ˆ ë ˆë²¨ì„ ë‹¤ì‹œ ì¡ì•„ì¤˜.";
        detailEl.textContent = "";
        return;
      }

      let dollarPer1 = 1;
      if (inst === "CL") dollarPer1 = 1000;   // 1ë‹¬ëŸ¬ ì›€ì§ì„ë‹¹ ì•½ $1,000
      else if (inst === "MCL") dollarPer1 = 100; // Micro CLì€ ì•½ $100

      const maxRisk = equity * (riskPct / 100);
      const perUnitRisk = Math.abs(entry - stop) * dollarPer1;

      if (perUnitRisk <= 0) {
        mainEl.textContent = "ì†ì ˆ í­ì´ 0ì— ê°€ê¹ë‹¤. ë ˆë²¨ì„ ë‹¤ì‹œ í™•ì¸í•´ì¤˜.";
        detailEl.textContent = "";
        return;
      }

      let units = Math.floor(maxRisk / perUnitRisk);
      if (units < 0) units = 0;

      const rewardPerUnit = Math.abs(target - entry) * dollarPer1;
      const totalRisk = perUnitRisk * units;
      const totalReward = rewardPerUnit * units;
      const rr = totalRisk > 0 ? (totalReward / totalRisk) : 0;

      if (units <= 0) {
        mainEl.textContent = "í˜„ì¬ ë¦¬ìŠ¤í¬ ì„¤ì •ìœ¼ë¡œëŠ” 1ê³„ì•½ë„ ë¬´ë¦¬ì¸ êµ¬ì¡°ì•¼. ì†ì ˆ í­ì„ ì¤„ì´ê±°ë‚˜ ë¦¬ìŠ¤í¬ %ë¥¼ ì¡°ê¸ˆ ì˜¬ë ¤ì•¼ í•´.";
      } else {
        mainEl.textContent = `ì´ ì…‹íŒ…ì´ë¼ë©´ ìµœëŒ€ ${units} ê³„ì•½ê¹Œì§€ ì§„ì… ê°€ëŠ¥í•´.`;
      }

      detailEl.textContent =
        `íŠ¸ë ˆì´ë“œë‹¹ í—ˆìš©ì†ì‹¤: ì•½ $${maxRisk.toFixed(0)} / ` +
        `1ê³„ì•½ ìœ„í—˜: ì•½ $${perUnitRisk.toFixed(0)} / ` +
        `ëª©í‘œ ë„ë‹¬ ì‹œ ì˜ˆìƒ ìˆ˜ìµ: ì•½ $${totalReward.toFixed(0)} (ì†ìµë¹„ ì•½ ${rr.toFixed(2)}R).`;
    }

    document.getElementById("psCalcBtn").addEventListener("click", calcPositionSize);

    // ========================
    // 7) ì˜¤ëŠ˜ ë·° ë©”ëª¨ ì‹œíŠ¸ ì €ì¥
    // ========================
    document.getElementById("saveMemoBtn").addEventListener("click", async () => {
      const statusEl = document.getElementById("memoStatus");
      const memo = document.getElementById("todayMemo").value || "";

      const vix = document.getElementById("vix").value;
      const dxy = document.getElementById("dxy").value;
      const y10 = document.getElementById("yield10").value;
      const spr = document.getElementById("spread").value;
      const wti = document.getElementById("wti").value;
      const brent = document.getElementById("brent").value;
      const rbob = document.getElementById("rbob").value;
      const ho = document.getElementById("heat").value;

      const crude = document.getElementById("eiaCrude").value;
      const gas = document.getElementById("eiaGas").value;
      const dist = document.getElementById("eiaDist").value;

      const payload = {
        timestamp: new Date().toISOString(),
        vix, dxy, yield10: y10, spread: spr, wti, brent, rbob, heat: ho,
        eiaCrude: crude, eiaGas: gas, eiaDist: dist,
        macroScore: lastMacroScore,
        oilScore: lastOilScore,
        memo
      };

      statusEl.textContent = "ì‹œíŠ¸ì— ì €ì¥ ì¤‘...";

      try {
        const res = await fetch(MEMO_WEB_APP_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (!res.ok) {
          statusEl.textContent = "ì €ì¥ ì‹¤íŒ¨: Web App ì‘ë‹µ ì½”ë“œ " + res.status;
          return;
        }

        const data = await res.json().catch(() => ({}));
        if (data.error) {
          statusEl.textContent = "ì €ì¥ ì‹¤íŒ¨: " + (data.message || "Apps Scriptì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí•œ ê²ƒ ê°™ì•„.");
        } else {
          statusEl.textContent = "ì €ì¥ ì™„ë£Œ! (ì‹œíŠ¸ì—ì„œ ì˜¤ëŠ˜ í–‰ì„ í™•ì¸í•´ë´.)";
        }
      } catch (e) {
        console.error(e);
        statusEl.textContent = "ì €ì¥ ì¤‘ ì—ëŸ¬ ë°œìƒ. ë¸Œë¼ìš°ì € ì½˜ì†”ì„ í™•ì¸í•´ì¤˜.";
      }
    });

    // ========================
    // 8) OPEC ì¼ì • ë Œë”ë§
    // ========================
    function renderOpecEvents() {
      const container = document.getElementById("opecList");
      if (!container) return;
      container.innerHTML = "";

      if (!Array.isArray(OPEC_EVENTS) || OPEC_EVENTS.length === 0) {
        const div = document.createElement("div");
        div.className = "helper";
        div.textContent = "ë“±ë¡ëœ OPEC ì´ë²¤íŠ¸ê°€ ì—†ë‹¤. ìŠ¤í¬ë¦½íŠ¸ì˜ OPEC_EVENTS ë°°ì—´ì— ì¼ì •ì„ ì¶”ê°€í•´ì¤˜.";
        container.appendChild(div);
        return;
      }

      const today = new Date();
      const items = OPEC_EVENTS.map(ev => {
        const d = new Date(ev.date + "T00:00:00");
        const diffMs = d - today;
        const diffDays = Math.round(diffMs / (1000 * 60 * 60 * 24));
        return {
          ...ev,
          dateObj: d,
          dday: diffDays
        };
      }).sort((a, b) => a.dateObj - b.dateObj);

      items.forEach((ev, idx) => {
        const item = document.createElement("div");
        item.className = "opec-item";

        const main = document.createElement("div");
        main.className = "opec-main";

        const title = document.createElement("div");
        title.className = "opec-title";
        title.textContent = ev.title;

        const meta = document.createElement("div");
        meta.className = "opec-meta";
        const y = ev.dateObj.getFullYear();
        const m = String(ev.dateObj.getMonth() + 1).padStart(2, "0");
        const d = String(ev.dateObj.getDate()).padStart(2, "0");
        meta.textContent = `${y}-${m}-${d}`;

        const note = document.createElement("div");
        note.className = "opec-note";
        note.textContent = ev.note || "";

        main.appendChild(title);
        main.appendChild(meta);
        if (ev.note) main.appendChild(note);

        const right = document.createElement("div");
        right.style.display = "flex";
        right.style.flexDirection = "column";
        right.style.alignItems = "flex-end";
        right.style.gap = "4px";

        const tag = document.createElement("div");
        tag.className = "opec-tag";
        if (ev.importance === "high") {
          tag.classList.add("opec-tag-high");
          tag.textContent = "í•µì‹¬ ì´ë²¤íŠ¸";
        } else if (ev.importance === "normal") {
          tag.classList.add("opec-tag-normal");
          tag.textContent = "ì¤‘ìš” ì²´í¬";
        } else {
          tag.classList.add("opec-tag-soft");
          tag.textContent = "í†¤ í™•ì¸ìš©";
        }

        const dday = document.createElement("div");
        dday.className = "opec-dday";
        let label;
        if (ev.dday > 0) label = `D-${ev.dday}`;
        else if (ev.dday === 0) label = "D-DAY";
        else label = `D+${Math.abs(ev.dday)}`;
        dday.textContent = label;

        if (idx === 0 && ev.dday >= 0) {
          const sub = document.createElement("span");
          sub.textContent = "NEXT OPEC ì´ë²¤íŠ¸";
          dday.appendChild(sub);
        }

        right.appendChild(tag);
        right.appendChild(dday);

        item.appendChild(main);
        item.appendChild(right);
        container.appendChild(item);
      });
    }

    // ì´ˆê¸° ìƒíƒœ
    updateOilSection();
    renderOpecEvents();
  </script>
</body>
</html>
